<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>polus.models API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../polus.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;polus</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="function" href="#load_model">load_model</a>
            </li>
            <li>
                    <a class="function" href="#resolve_activation">resolve_activation</a>
            </li>
            <li>
                    <a class="function" href="#from_config">from_config</a>
            </li>
            <li>
                    <a class="class" href="#PolusModel">PolusModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PolusModel.__init__">PolusModel</a>
                        </li>
                        <li>
                                <a class="function" href="#PolusModel.init_from_data">init_from_data</a>
                        </li>
                        <li>
                                <a class="function" href="#PolusModel.set_name">set_name</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SavableModel">SavableModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SavableModel.__init__">SavableModel</a>
                        </li>
                        <li>
                                <a class="function" href="#SavableModel.save">save</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SequentialSavableModel">SequentialSavableModel</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SequentialSavableModel.__init__">SequentialSavableModel</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#PolusClassifier">PolusClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#PolusClassifier.__init__">PolusClassifier</a>
                        </li>
                        <li>
                                <a class="function" href="#PolusClassifier.inference">inference</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#SequentialPolusClassifier">SequentialPolusClassifier</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#SequentialPolusClassifier.__init__">SequentialPolusClassifier</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#TFBertSplited">TFBertSplited</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TFBertSplited.__init__">TFBertSplited</a>
                        </li>
                        <li>
                                <a class="function" href="#TFBertSplited.call">call</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#split_bert_model_from_checkpoint">split_bert_model_from_checkpoint</a>
            </li>
            <li>
                    <a class="function" href="#split_bert_model">split_bert_model</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../polus.html">polus</a><wbr>.models    </h1>

                
                        <input id="models-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="models-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="kn">import</span> <span class="nn">tensorflow_addons</span> <span class="k">as</span> <span class="nn">tfa</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="kn">import</span> <span class="nn">h5py</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="kn">import</span> <span class="nn">pickle</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="kn">import</span> <span class="nn">types</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="kn">from</span> <span class="nn">polus</span> <span class="kn">import</span> <span class="n">logger</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="kn">from</span> <span class="nn">polus.core</span> <span class="kn">import</span> <span class="n">get_jit_compile</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="kn">from</span> <span class="nn">polus.utils</span> <span class="kn">import</span> <span class="n">merge_dicts</span><span class="p">,</span> <span class="n">flatten_dict</span><span class="p">,</span> <span class="n">complex_json_serializer</span><span class="p">,</span> <span class="n">complex_json_deserializer</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1">#import for refering to this file, used in the load_model method</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="kn">import</span> <span class="nn">polus.models</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">,</span> <span class="n">change_config</span><span class="o">=</span><span class="p">{},</span> <span class="n">external_module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>    
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a>    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>    
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>        <span class="n">cfg</span> <span class="o">=</span> <span class="n">complex_json_deserializer</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>    
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>    <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">change_config</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a>    
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>    <span class="c1"># TODO: For adding the possibility to load from best HPO cfg,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a>    <span class="c1"># just load the best HPO trial, then add it to the HPO_Context</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>    <span class="c1"># it should work :) </span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a>    
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>    <span class="k">if</span> <span class="n">external_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">external_module</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">])(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">polus</span><span class="o">.</span><span class="n">models</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">])(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>    
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>    <span class="c1"># correctly init the model from samples if given</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">):</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Init the loaded model&quot;</span><span class="p">)</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">init_from_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>    
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a>    <span class="c1"># load weights</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>        <span class="n">weight</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>            <span class="n">weight</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)][:])</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>    <span class="k">return</span> <span class="n">model</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a>        
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="k">def</span> <span class="nf">resolve_activation</span><span class="p">(</span><span class="n">activation_name</span><span class="p">):</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>    <span class="k">if</span> <span class="n">activation_name</span><span class="o">==</span><span class="s2">&quot;mish&quot;</span><span class="p">:</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="k">return</span> <span class="n">tfa</span><span class="o">.</span><span class="n">activations</span><span class="o">.</span><span class="n">mish</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a>        <span class="k">return</span> <span class="n">activation_name</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">function_wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>        
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>        <span class="c1"># run resolve_activation</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>        <span class="k">if</span> <span class="s2">&quot;activation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>            <span class="c1"># cache the reference for the activation</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>            <span class="n">_activation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolve_activation</span><span class="p">(</span><span class="n">_activation</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>        
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>        
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>        <span class="c1"># restore the original activation reference for saving</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>        <span class="k">if</span> <span class="s2">&quot;activation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_activation</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a>        
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">savable_config</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="k">return</span> <span class="n">model</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>    <span class="k">return</span> <span class="n">function_wrapper</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="k">class</span> <span class="nc">PolusModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>    
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a>        
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a>    
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a>    <span class="k">def</span> <span class="nf">init_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        The model was not yet built and therefore, it needs to</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">        receive some correct samples in order to lazy init all</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        of the layers</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a>        
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>        <span class="c1">## init from training data</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>        
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="c1"># store the samples that are given to the model</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>    
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a><span class="k">class</span> <span class="nc">SavableModel</span><span class="p">(</span><span class="n">PolusModel</span><span class="p">):</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>    
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>             <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.polus_cache&quot;</span><span class="p">,</span><span class="s2">&quot;saved_models&quot;</span><span class="p">),</span> 
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>             <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="n">extension</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>        
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.cfg&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>            <span class="n">json_str</span> <span class="o">=</span> <span class="n">complex_json_serializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savable_config</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_str</span> <span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>        
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_init&quot;</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>        <span class="c1">#save model weights</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weight</span><span class="p">)):</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a><span class="k">class</span> <span class="nc">SequentialSavableModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">SavableModel</span><span class="p">):</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a><span class="sd">    This class is just to be compatible with the Sequential Model from keras and implements</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a><span class="sd">    the same inference method from the SavableModel class</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="k">class</span> <span class="nc">PolusClassifier</span><span class="p">(</span><span class="n">SavableModel</span><span class="p">):</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>    
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>    
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="k">class</span> <span class="nc">SequentialPolusClassifier</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">PolusClassifier</span><span class="p">):</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>    
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="kn">from</span> <span class="nn">transformers.modeling_tf_utils</span> <span class="kn">import</span> <span class="n">shape_list</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">TFBertModel</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>        
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="kn">from</span> <span class="nn">transformers.modeling_tf_outputs</span> <span class="kn">import</span> <span class="n">TFBaseModelOutputWithPooling</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="kn">from</span> <span class="nn">transformers.file_utils</span> <span class="kn">import</span> <span class="n">DUMMY_INPUTS</span><span class="p">,</span> <span class="n">DUMMY_MASK</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a><span class="k">class</span> <span class="nc">TFBertSplited</span><span class="p">(</span><span class="n">PolusModel</span><span class="p">):</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>    
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>                 <span class="n">bert_layers</span><span class="p">,</span> 
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>                 <span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">bert_layers</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="n">run_in_training_mode</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">_efficient_attention_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>        <span class="c1"># This codes mimics the transformer BERT implementation: https://github.com/huggingface/transformers/blob/master/src/transformers/models/bert/modeling_tf_bert.py#L1057</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>        
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>        <span class="n">attention_mask_shape</span> <span class="o">=</span> <span class="n">shape_list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>                <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">attention_mask_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">attention_mask_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="c1"># Since attention_mask is 1.0 for positions we want to attend and 0.0 for</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="c1"># masked positions, this operation will create a tensor which is 0.0 for</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>        <span class="c1"># positions we want to attend and -10000.0 for masked positions.</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Since we are adding it to the raw scores before the softmax, this is</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="c1"># effectively the same as removing these entirely.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">extended_attention_mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">one_cst</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>        <span class="n">ten_thousand_cst</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="o">-</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">one_cst</span><span class="p">,</span> <span class="n">extended_attention_mask</span><span class="p">),</span> <span class="n">ten_thousand_cst</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="n">extended_attention_mask</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">input_signature</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">bool</span><span class="p">)],</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>                <span class="n">jit_compile</span><span class="o">=</span><span class="n">get_jit_compile</span><span class="p">())</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">attention_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_efficient_attention_mask</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">)</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="k">for</span> <span class="n">layer_module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">:</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="n">hidden_states</span> <span class="o">=</span> <span class="n">layer_module</span><span class="p">(</span><span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span> 
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>                                         <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>                                         <span class="n">head_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>                                         <span class="n">output_attentions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>                                         <span class="n">encoder_hidden_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>                                         <span class="n">encoder_attention_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>                                         <span class="n">past_key_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>                                         <span class="n">training</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">&amp;</span> <span class="n">training</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>        <span class="k">return</span> <span class="n">TFBaseModelOutputWithPooling</span><span class="p">(</span><span class="n">last_hidden_state</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>                                            <span class="n">pooler_output</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:])</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>    
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="k">def</span> <span class="nf">split_bert_model_from_checkpoint</span><span class="p">(</span><span class="n">bert_model_checkpoint</span><span class="p">,</span> 
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>                                     <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>                                     <span class="n">init_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                                     <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>                                     <span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>    
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>    <span class="n">bert_model</span> <span class="o">=</span> <span class="n">TFBertModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">bert_model_checkpoint</span><span class="p">,</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                                             <span class="n">output_attentions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>                                             <span class="n">output_hidden_states</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                                             <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                                             <span class="n">from_pt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>    
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">split_bert_model</span><span class="p">(</span><span class="n">bert_model</span><span class="p">,</span> 
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                              <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>                              <span class="n">init_models</span><span class="o">=</span><span class="n">init_models</span><span class="p">,</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>                              <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="n">return_pre_bert_model</span><span class="p">,</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                              <span class="n">return_post_bert_model</span><span class="o">=</span><span class="n">return_post_bert_model</span><span class="p">)</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>    
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>        <span class="k">del</span> <span class="n">bert_model</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>    
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>    <span class="k">return</span> <span class="n">output</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>    
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="k">def</span> <span class="nf">split_bert_model</span><span class="p">(</span><span class="n">bert_model</span><span class="p">,</span> 
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>                     <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>                     <span class="n">init_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>                     <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>                     <span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a><span class="sd">    Utility function that splits a bert model in a pre established index, given by *index_layer*,</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a><span class="sd">    which results into two models. The *pre_model* that corresponds to the *bert_model* but without</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a><span class="sd">    a some layers that were cut off and a *post_model* that corresponds to a *PolusModel*, which runs</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a><span class="sd">    the remain bert layers.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">assert</span> <span class="n">return_pre_bert_model</span> <span class="ow">or</span> <span class="n">return_post_bert_model</span> <span class="c1"># at least one must be true</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>    
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="k">assert</span>  <span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="o">&gt;</span> <span class="n">index_layer</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="ow">and</span> <span class="n">index_layer</span><span class="o">!=</span><span class="mi">0</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>    
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="c1"># create a new keras model that uses the layers previous removed bert layers</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>    <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">encoder_layers</span> <span class="o">=</span> <span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">[</span><span class="n">index_layer</span><span class="p">:]</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">post_model</span> <span class="o">=</span> <span class="n">TFBertSplited</span><span class="p">(</span><span class="n">encoder_layers</span><span class="p">)</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>    
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="k">del</span> <span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">[</span><span class="n">index_layer</span><span class="p">:]</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="k">del</span> <span class="n">bert_model</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>    <span class="k">if</span> <span class="n">init_models</span> <span class="ow">and</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>        <span class="c1"># run a dummy example to build post_model and check for errors</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>        <span class="n">sample</span> <span class="o">=</span> <span class="s2">&quot;hello, this is a sample that i want to tokenize&quot;</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_name_or_path</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>                                           <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>                                           <span class="n">truncation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>                                           <span class="n">max_length</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>                                           <span class="n">return_attention_mask</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>                                           <span class="n">return_token_type_ids</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>                                           <span class="n">return_tensors</span> <span class="o">=</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>                                          <span class="p">)</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="n">hidden_states</span> <span class="o">=</span> <span class="n">bert_model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)[</span><span class="s2">&quot;last_hidden_state&quot;</span><span class="p">]</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>            
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>            <span class="n">post_model</span><span class="p">(</span><span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">])</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>    
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span> <span class="ow">and</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a>        <span class="k">return</span> <span class="n">bert_model</span><span class="p">,</span> <span class="n">post_model</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a>        <span class="k">return</span> <span class="n">bert_model</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a>    <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a>        <span class="k">return</span> <span class="n">post_model</span>
</span></pre></div>


            </section>
                <section id="load_model">
                            <input id="load_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">load_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">file_name_w_ext</span>, </span><span class="param"><span class="n">change_config</span><span class="o">=</span><span class="p">{}</span>, </span><span class="param"><span class="n">external_module</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="load_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#load_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="load_model-19"><a href="#load_model-19"><span class="linenos">19</span></a><span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">,</span> <span class="n">change_config</span><span class="o">=</span><span class="p">{},</span> <span class="n">external_module</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="load_model-20"><a href="#load_model-20"><span class="linenos">20</span></a>    
</span><span id="load_model-21"><a href="#load_model-21"><span class="linenos">21</span></a>    <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="load_model-22"><a href="#load_model-22"><span class="linenos">22</span></a>    
</span><span id="load_model-23"><a href="#load_model-23"><span class="linenos">23</span></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name_w_ext</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="load_model-24"><a href="#load_model-24"><span class="linenos">24</span></a>        <span class="n">cfg</span> <span class="o">=</span> <span class="n">complex_json_deserializer</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
</span><span id="load_model-25"><a href="#load_model-25"><span class="linenos">25</span></a>    
</span><span id="load_model-26"><a href="#load_model-26"><span class="linenos">26</span></a>    <span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_dicts</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">],</span> <span class="n">change_config</span><span class="p">)</span>
</span><span id="load_model-27"><a href="#load_model-27"><span class="linenos">27</span></a>    
</span><span id="load_model-28"><a href="#load_model-28"><span class="linenos">28</span></a>    <span class="c1"># TODO: For adding the possibility to load from best HPO cfg,</span>
</span><span id="load_model-29"><a href="#load_model-29"><span class="linenos">29</span></a>    <span class="c1"># just load the best HPO trial, then add it to the HPO_Context</span>
</span><span id="load_model-30"><a href="#load_model-30"><span class="linenos">30</span></a>    <span class="c1"># it should work :) </span>
</span><span id="load_model-31"><a href="#load_model-31"><span class="linenos">31</span></a>    
</span><span id="load_model-32"><a href="#load_model-32"><span class="linenos">32</span></a>    <span class="k">if</span> <span class="n">external_module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="load_model-33"><a href="#load_model-33"><span class="linenos">33</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">external_module</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">])(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="load_model-34"><a href="#load_model-34"><span class="linenos">34</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="load_model-35"><a href="#load_model-35"><span class="linenos">35</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">polus</span><span class="o">.</span><span class="n">models</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">])(</span><span class="o">**</span><span class="n">cfg</span><span class="p">)</span>
</span><span id="load_model-36"><a href="#load_model-36"><span class="linenos">36</span></a>    
</span><span id="load_model-37"><a href="#load_model-37"><span class="linenos">37</span></a>    <span class="c1"># correctly init the model from samples if given</span>
</span><span id="load_model-38"><a href="#load_model-38"><span class="linenos">38</span></a>    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">):</span>
</span><span id="load_model-39"><a href="#load_model-39"><span class="linenos">39</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="load_model-40"><a href="#load_model-40"><span class="linenos">40</span></a>            <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="load_model-41"><a href="#load_model-41"><span class="linenos">41</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Init the loaded model&quot;</span><span class="p">)</span>
</span><span id="load_model-42"><a href="#load_model-42"><span class="linenos">42</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">init_from_data</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="load_model-43"><a href="#load_model-43"><span class="linenos">43</span></a>    
</span><span id="load_model-44"><a href="#load_model-44"><span class="linenos">44</span></a>    <span class="c1"># load weights</span>
</span><span id="load_model-45"><a href="#load_model-45"><span class="linenos">45</span></a>    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">file_name</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="load_model-46"><a href="#load_model-46"><span class="linenos">46</span></a>        <span class="n">weight</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="load_model-47"><a href="#load_model-47"><span class="linenos">47</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
</span><span id="load_model-48"><a href="#load_model-48"><span class="linenos">48</span></a>            <span class="n">weight</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;weight&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)][:])</span>
</span><span id="load_model-49"><a href="#load_model-49"><span class="linenos">49</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</span><span id="load_model-50"><a href="#load_model-50"><span class="linenos">50</span></a>    
</span><span id="load_model-51"><a href="#load_model-51"><span class="linenos">51</span></a>    <span class="k">return</span> <span class="n">model</span>
</span></pre></div>


    

                </section>
                <section id="resolve_activation">
                            <input id="resolve_activation-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resolve_activation</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">activation_name</span></span>)</span>

                <label class="view-source-button" for="resolve_activation-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resolve_activation"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resolve_activation-54"><a href="#resolve_activation-54"><span class="linenos">54</span></a><span class="k">def</span> <span class="nf">resolve_activation</span><span class="p">(</span><span class="n">activation_name</span><span class="p">):</span>
</span><span id="resolve_activation-55"><a href="#resolve_activation-55"><span class="linenos">55</span></a>    <span class="k">if</span> <span class="n">activation_name</span><span class="o">==</span><span class="s2">&quot;mish&quot;</span><span class="p">:</span>
</span><span id="resolve_activation-56"><a href="#resolve_activation-56"><span class="linenos">56</span></a>        <span class="k">return</span> <span class="n">tfa</span><span class="o">.</span><span class="n">activations</span><span class="o">.</span><span class="n">mish</span>
</span><span id="resolve_activation-57"><a href="#resolve_activation-57"><span class="linenos">57</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="resolve_activation-58"><a href="#resolve_activation-58"><span class="linenos">58</span></a>        <span class="k">return</span> <span class="n">activation_name</span>
</span></pre></div>


    

                </section>
                <section id="from_config">
                            <input id="from_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">from_config</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">func</span></span>)</span>

                <label class="view-source-button" for="from_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#from_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="from_config-61"><a href="#from_config-61"><span class="linenos">61</span></a><span class="k">def</span> <span class="nf">from_config</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="from_config-62"><a href="#from_config-62"><span class="linenos">62</span></a>    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="from_config-63"><a href="#from_config-63"><span class="linenos">63</span></a>    <span class="k">def</span> <span class="nf">function_wrapper</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="from_config-64"><a href="#from_config-64"><span class="linenos">64</span></a>        
</span><span id="from_config-65"><a href="#from_config-65"><span class="linenos">65</span></a>        <span class="c1"># run resolve_activation</span>
</span><span id="from_config-66"><a href="#from_config-66"><span class="linenos">66</span></a>        <span class="k">if</span> <span class="s2">&quot;activation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="from_config-67"><a href="#from_config-67"><span class="linenos">67</span></a>            <span class="c1"># cache the reference for the activation</span>
</span><span id="from_config-68"><a href="#from_config-68"><span class="linenos">68</span></a>            <span class="n">_activation</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span>
</span><span id="from_config-69"><a href="#from_config-69"><span class="linenos">69</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resolve_activation</span><span class="p">(</span><span class="n">_activation</span><span class="p">)</span>
</span><span id="from_config-70"><a href="#from_config-70"><span class="linenos">70</span></a>        
</span><span id="from_config-71"><a href="#from_config-71"><span class="linenos">71</span></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">**</span><span class="n">flatten_dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">))</span>
</span><span id="from_config-72"><a href="#from_config-72"><span class="linenos">72</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;func_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="from_config-73"><a href="#from_config-73"><span class="linenos">73</span></a>        
</span><span id="from_config-74"><a href="#from_config-74"><span class="linenos">74</span></a>        <span class="c1"># restore the original activation reference for saving</span>
</span><span id="from_config-75"><a href="#from_config-75"><span class="linenos">75</span></a>        <span class="k">if</span> <span class="s2">&quot;activation&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]:</span>
</span><span id="from_config-76"><a href="#from_config-76"><span class="linenos">76</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">][</span><span class="s2">&quot;activation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_activation</span>
</span><span id="from_config-77"><a href="#from_config-77"><span class="linenos">77</span></a>        
</span><span id="from_config-78"><a href="#from_config-78"><span class="linenos">78</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="from_config-79"><a href="#from_config-79"><span class="linenos">79</span></a>        <span class="n">model</span><span class="o">.</span><span class="n">savable_config</span> <span class="o">=</span> <span class="n">kwargs</span>
</span><span id="from_config-80"><a href="#from_config-80"><span class="linenos">80</span></a>
</span><span id="from_config-81"><a href="#from_config-81"><span class="linenos">81</span></a>        <span class="k">return</span> <span class="n">model</span>
</span><span id="from_config-82"><a href="#from_config-82"><span class="linenos">82</span></a>
</span><span id="from_config-83"><a href="#from_config-83"><span class="linenos">83</span></a>    <span class="k">return</span> <span class="n">function_wrapper</span>
</span></pre></div>


    

                </section>
                <section id="PolusModel">
                            <input id="PolusModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PolusModel</span><wbr>(<span class="base">keras.engine.training.Model</span>):

                <label class="view-source-button" for="PolusModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusModel-86"><a href="#PolusModel-86"><span class="linenos"> 86</span></a><span class="k">class</span> <span class="nc">PolusModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span><span id="PolusModel-87"><a href="#PolusModel-87"><span class="linenos"> 87</span></a>    
</span><span id="PolusModel-88"><a href="#PolusModel-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusModel-89"><a href="#PolusModel-89"><span class="linenos"> 89</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="PolusModel-90"><a href="#PolusModel-90"><span class="linenos"> 90</span></a>        
</span><span id="PolusModel-91"><a href="#PolusModel-91"><span class="linenos"> 91</span></a>    
</span><span id="PolusModel-92"><a href="#PolusModel-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">init_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusModel-93"><a href="#PolusModel-93"><span class="linenos"> 93</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PolusModel-94"><a href="#PolusModel-94"><span class="linenos"> 94</span></a><span class="sd">        The model was not yet built and therefore, it needs to</span>
</span><span id="PolusModel-95"><a href="#PolusModel-95"><span class="linenos"> 95</span></a><span class="sd">        receive some correct samples in order to lazy init all</span>
</span><span id="PolusModel-96"><a href="#PolusModel-96"><span class="linenos"> 96</span></a><span class="sd">        of the layers</span>
</span><span id="PolusModel-97"><a href="#PolusModel-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PolusModel-98"><a href="#PolusModel-98"><span class="linenos"> 98</span></a>        
</span><span id="PolusModel-99"><a href="#PolusModel-99"><span class="linenos"> 99</span></a>        <span class="c1">## init from training data</span>
</span><span id="PolusModel-100"><a href="#PolusModel-100"><span class="linenos">100</span></a>        
</span><span id="PolusModel-101"><a href="#PolusModel-101"><span class="linenos">101</span></a>        <span class="c1"># store the samples that are given to the model</span>
</span><span id="PolusModel-102"><a href="#PolusModel-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="PolusModel-103"><a href="#PolusModel-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="PolusModel-104"><a href="#PolusModel-104"><span class="linenos">104</span></a>    
</span><span id="PolusModel-105"><a href="#PolusModel-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="PolusModel-106"><a href="#PolusModel-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span></pre></div>


            <div class="docstring"><p><code>Model</code> groups layers into an object with training and inference features.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>inputs:</strong>  The input(s) of the model: a <code>keras.Input</code> object or list of
<code>keras.Input</code> objects.</li>
<li><strong>outputs:</strong>  The output(s) of the model. See Functional API example below.</li>
<li><strong>name:</strong>  String, the name of the model.</li>
</ul>

<p>There are two ways to instantiate a <code>Model</code>:</p>

<p>1 - With the "Functional API", where you start from <code>Input</code>,
you chain layer calls to specify the model's forward pass,
and finally you create your model from inputs and outputs:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div>

<p>Note: Only dicts, lists, and tuples of input tensors are supported. Nested
inputs are not supported (e.g. lists of list or dicts of dict).</p>

<p>A new Functional API model can also be created by using the
intermediate tensors. This enables you to quickly extract sub-components
of the model.</p>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">processed</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">32</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="n">processed</span><span class="p">)</span>
<span class="n">pooling</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="n">pooling</span><span class="p">)</span>

<span class="n">full_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
<span class="n">backbone</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
<span class="n">activations</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
</code></pre></div>

<p>Note that the <code>backbone</code> and <code>activations</code> models are not
created with <code>keras.Input</code> objects, but with the tensors that are originated
from <code>keras.Inputs</code> objects. Under the hood, the layers and weights will
be shared across these models, so that user can train the <code>full_model</code>, and
use <code>backbone</code> or <code>activations</code> to do feature extraction.
The inputs and outputs of the model can be nested structures of tensors as
well, and the created models are standard Functional API models that support
all the existing APIs.</p>

<p>2 - By subclassing the <code>Model</code> class: in that case, you should define your
layers in <code><a href="#PolusModel.__init__">__init__()</a></code> and you should implement the model's forward pass
in <code><a href="#PolusModel.call">call()</a></code>.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>If you subclass <code>Model</code>, you can optionally have
a <code>training</code> argument (boolean) in <code><a href="#PolusModel.call">call()</a></code>, which you can use to specify
a different behavior in training and inference:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>Once the model is created, you can config the model with losses and metrics
with <code>model.compile()</code>, train the model with <code>model.fit()</code>, or use the model
to do prediction with <code>model.predict()</code>.</p>
</div>


                            <div id="PolusModel.__init__" class="classattr">
                                        <input id="PolusModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PolusModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="PolusModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusModel.__init__-88"><a href="#PolusModel.__init__-88"><span class="linenos">88</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusModel.__init__-89"><a href="#PolusModel.__init__-89"><span class="linenos">89</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="PolusModel.init_from_data" class="classattr">
                                        <input id="PolusModel.init_from_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">init_from_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="PolusModel.init_from_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusModel.init_from_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusModel.init_from_data-92"><a href="#PolusModel.init_from_data-92"><span class="linenos"> 92</span></a>    <span class="k">def</span> <span class="nf">init_from_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusModel.init_from_data-93"><a href="#PolusModel.init_from_data-93"><span class="linenos"> 93</span></a>        <span class="sd">&quot;&quot;&quot;</span>
</span><span id="PolusModel.init_from_data-94"><a href="#PolusModel.init_from_data-94"><span class="linenos"> 94</span></a><span class="sd">        The model was not yet built and therefore, it needs to</span>
</span><span id="PolusModel.init_from_data-95"><a href="#PolusModel.init_from_data-95"><span class="linenos"> 95</span></a><span class="sd">        receive some correct samples in order to lazy init all</span>
</span><span id="PolusModel.init_from_data-96"><a href="#PolusModel.init_from_data-96"><span class="linenos"> 96</span></a><span class="sd">        of the layers</span>
</span><span id="PolusModel.init_from_data-97"><a href="#PolusModel.init_from_data-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="PolusModel.init_from_data-98"><a href="#PolusModel.init_from_data-98"><span class="linenos"> 98</span></a>        
</span><span id="PolusModel.init_from_data-99"><a href="#PolusModel.init_from_data-99"><span class="linenos"> 99</span></a>        <span class="c1">## init from training data</span>
</span><span id="PolusModel.init_from_data-100"><a href="#PolusModel.init_from_data-100"><span class="linenos">100</span></a>        
</span><span id="PolusModel.init_from_data-101"><a href="#PolusModel.init_from_data-101"><span class="linenos">101</span></a>        <span class="c1"># store the samples that are given to the model</span>
</span><span id="PolusModel.init_from_data-102"><a href="#PolusModel.init_from_data-102"><span class="linenos">102</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="PolusModel.init_from_data-103"><a href="#PolusModel.init_from_data-103"><span class="linenos">103</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>The model was not yet built and therefore, it needs to
receive some correct samples in order to lazy init all
of the layers</p>
</div>


                            </div>
                            <div id="PolusModel.set_name" class="classattr">
                                        <input id="PolusModel.set_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span></span>)</span>

                <label class="view-source-button" for="PolusModel.set_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusModel.set_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusModel.set_name-105"><a href="#PolusModel.set_name-105"><span class="linenos">105</span></a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span id="PolusModel.set_name-106"><a href="#PolusModel.set_name-106"><span class="linenos">106</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>keras.engine.training.Model</dt>
                                <dd id="PolusModel.build" class="function">build</dd>
                <dd id="PolusModel.call" class="function">call</dd>
                <dd id="PolusModel.compile" class="function">compile</dd>
                <dd id="PolusModel.metrics" class="variable">metrics</dd>
                <dd id="PolusModel.metrics_names" class="variable">metrics_names</dd>
                <dd id="PolusModel.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="PolusModel.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="PolusModel.train_step" class="function">train_step</dd>
                <dd id="PolusModel.compute_loss" class="function">compute_loss</dd>
                <dd id="PolusModel.compute_metrics" class="function">compute_metrics</dd>
                <dd id="PolusModel.make_train_function" class="function">make_train_function</dd>
                <dd id="PolusModel.fit" class="function">fit</dd>
                <dd id="PolusModel.test_step" class="function">test_step</dd>
                <dd id="PolusModel.make_test_function" class="function">make_test_function</dd>
                <dd id="PolusModel.evaluate" class="function">evaluate</dd>
                <dd id="PolusModel.predict_step" class="function">predict_step</dd>
                <dd id="PolusModel.make_predict_function" class="function">make_predict_function</dd>
                <dd id="PolusModel.predict" class="function">predict</dd>
                <dd id="PolusModel.reset_metrics" class="function">reset_metrics</dd>
                <dd id="PolusModel.train_on_batch" class="function">train_on_batch</dd>
                <dd id="PolusModel.test_on_batch" class="function">test_on_batch</dd>
                <dd id="PolusModel.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="PolusModel.fit_generator" class="function">fit_generator</dd>
                <dd id="PolusModel.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="PolusModel.predict_generator" class="function">predict_generator</dd>
                <dd id="PolusModel.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="PolusModel.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="PolusModel.get_weights" class="function">get_weights</dd>
                <dd id="PolusModel.save" class="function">save</dd>
                <dd id="PolusModel.save_weights" class="function">save_weights</dd>
                <dd id="PolusModel.load_weights" class="function">load_weights</dd>
                <dd id="PolusModel.get_config" class="function">get_config</dd>
                <dd id="PolusModel.from_config" class="function">from_config</dd>
                <dd id="PolusModel.to_json" class="function">to_json</dd>
                <dd id="PolusModel.to_yaml" class="function">to_yaml</dd>
                <dd id="PolusModel.reset_states" class="function">reset_states</dd>
                <dd id="PolusModel.state_updates" class="variable">state_updates</dd>
                <dd id="PolusModel.weights" class="variable">weights</dd>
                <dd id="PolusModel.summary" class="function">summary</dd>
                <dd id="PolusModel.layers" class="variable">layers</dd>
                <dd id="PolusModel.get_layer" class="function">get_layer</dd>
                <dd id="PolusModel.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="PolusModel.add_weight" class="function">add_weight</dd>
                <dd id="PolusModel.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="PolusModel.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="PolusModel.compute_mask" class="function">compute_mask</dd>
                <dd id="PolusModel.dtype" class="variable">dtype</dd>
                <dd id="PolusModel.name" class="variable">name</dd>
                <dd id="PolusModel.supports_masking" class="variable">supports_masking</dd>
                <dd id="PolusModel.dynamic" class="variable">dynamic</dd>
                <dd id="PolusModel.stateful" class="variable">stateful</dd>
                <dd id="PolusModel.trainable" class="variable">trainable</dd>
                <dd id="PolusModel.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="PolusModel.input_spec" class="variable">input_spec</dd>
                <dd id="PolusModel.updates" class="variable">updates</dd>
                <dd id="PolusModel.losses" class="variable">losses</dd>
                <dd id="PolusModel.add_loss" class="function">add_loss</dd>
                <dd id="PolusModel.add_metric" class="function">add_metric</dd>
                <dd id="PolusModel.add_update" class="function">add_update</dd>
                <dd id="PolusModel.set_weights" class="function">set_weights</dd>
                <dd id="PolusModel.finalize_state" class="function">finalize_state</dd>
                <dd id="PolusModel.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="PolusModel.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="PolusModel.input_mask" class="variable">input_mask</dd>
                <dd id="PolusModel.output_mask" class="variable">output_mask</dd>
                <dd id="PolusModel.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="PolusModel.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="PolusModel.get_input_at" class="function">get_input_at</dd>
                <dd id="PolusModel.get_output_at" class="function">get_output_at</dd>
                <dd id="PolusModel.input" class="variable">input</dd>
                <dd id="PolusModel.output" class="variable">output</dd>
                <dd id="PolusModel.input_shape" class="variable">input_shape</dd>
                <dd id="PolusModel.count_params" class="function">count_params</dd>
                <dd id="PolusModel.output_shape" class="variable">output_shape</dd>
                <dd id="PolusModel.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="PolusModel.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="PolusModel.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="PolusModel.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="PolusModel.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="PolusModel.variables" class="variable">variables</dd>
                <dd id="PolusModel.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="PolusModel.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="PolusModel.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="PolusModel.name_scope" class="variable">name_scope</dd>
                <dd id="PolusModel.submodules" class="variable">submodules</dd>
                <dd id="PolusModel.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SavableModel">
                            <input id="SavableModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SavableModel</span><wbr>(<span class="base"><a href="#PolusModel">PolusModel</a></span>):

                <label class="view-source-button" for="SavableModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SavableModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SavableModel-108"><a href="#SavableModel-108"><span class="linenos">108</span></a><span class="k">class</span> <span class="nc">SavableModel</span><span class="p">(</span><span class="n">PolusModel</span><span class="p">):</span>
</span><span id="SavableModel-109"><a href="#SavableModel-109"><span class="linenos">109</span></a>    
</span><span id="SavableModel-110"><a href="#SavableModel-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SavableModel-111"><a href="#SavableModel-111"><span class="linenos">111</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="SavableModel-112"><a href="#SavableModel-112"><span class="linenos">112</span></a>    
</span><span id="SavableModel-113"><a href="#SavableModel-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="SavableModel-114"><a href="#SavableModel-114"><span class="linenos">114</span></a>             <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.polus_cache&quot;</span><span class="p">,</span><span class="s2">&quot;saved_models&quot;</span><span class="p">),</span> 
</span><span id="SavableModel-115"><a href="#SavableModel-115"><span class="linenos">115</span></a>             <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SavableModel-116"><a href="#SavableModel-116"><span class="linenos">116</span></a>        
</span><span id="SavableModel-117"><a href="#SavableModel-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
</span><span id="SavableModel-118"><a href="#SavableModel-118"><span class="linenos">118</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
</span><span id="SavableModel-119"><a href="#SavableModel-119"><span class="linenos">119</span></a>        
</span><span id="SavableModel-120"><a href="#SavableModel-120"><span class="linenos">120</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="n">extension</span><span class="p">)</span>
</span><span id="SavableModel-121"><a href="#SavableModel-121"><span class="linenos">121</span></a>        
</span><span id="SavableModel-122"><a href="#SavableModel-122"><span class="linenos">122</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.cfg&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel-123"><a href="#SavableModel-123"><span class="linenos">123</span></a>            <span class="n">json_str</span> <span class="o">=</span> <span class="n">complex_json_serializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savable_config</span><span class="p">)</span>
</span><span id="SavableModel-124"><a href="#SavableModel-124"><span class="linenos">124</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_str</span> <span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="SavableModel-125"><a href="#SavableModel-125"><span class="linenos">125</span></a>        
</span><span id="SavableModel-126"><a href="#SavableModel-126"><span class="linenos">126</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_init&quot;</span><span class="p">):</span>
</span><span id="SavableModel-127"><a href="#SavableModel-127"><span class="linenos">127</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel-128"><a href="#SavableModel-128"><span class="linenos">128</span></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="SavableModel-129"><a href="#SavableModel-129"><span class="linenos">129</span></a>        
</span><span id="SavableModel-130"><a href="#SavableModel-130"><span class="linenos">130</span></a>        <span class="c1">#save model weights</span>
</span><span id="SavableModel-131"><a href="#SavableModel-131"><span class="linenos">131</span></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel-132"><a href="#SavableModel-132"><span class="linenos">132</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>
</span><span id="SavableModel-133"><a href="#SavableModel-133"><span class="linenos">133</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weight</span><span class="p">)):</span>
</span><span id="SavableModel-134"><a href="#SavableModel-134"><span class="linenos">134</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p><code>Model</code> groups layers into an object with training and inference features.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>inputs:</strong>  The input(s) of the model: a <code>keras.Input</code> object or list of
<code>keras.Input</code> objects.</li>
<li><strong>outputs:</strong>  The output(s) of the model. See Functional API example below.</li>
<li><strong>name:</strong>  String, the name of the model.</li>
</ul>

<p>There are two ways to instantiate a <code>Model</code>:</p>

<p>1 - With the "Functional API", where you start from <code>Input</code>,
you chain layer calls to specify the model's forward pass,
and finally you create your model from inputs and outputs:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div>

<p>Note: Only dicts, lists, and tuples of input tensors are supported. Nested
inputs are not supported (e.g. lists of list or dicts of dict).</p>

<p>A new Functional API model can also be created by using the
intermediate tensors. This enables you to quickly extract sub-components
of the model.</p>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">processed</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">32</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="n">processed</span><span class="p">)</span>
<span class="n">pooling</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="n">pooling</span><span class="p">)</span>

<span class="n">full_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
<span class="n">backbone</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
<span class="n">activations</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
</code></pre></div>

<p>Note that the <code>backbone</code> and <code>activations</code> models are not
created with <code>keras.Input</code> objects, but with the tensors that are originated
from <code>keras.Inputs</code> objects. Under the hood, the layers and weights will
be shared across these models, so that user can train the <code>full_model</code>, and
use <code>backbone</code> or <code>activations</code> to do feature extraction.
The inputs and outputs of the model can be nested structures of tensors as
well, and the created models are standard Functional API models that support
all the existing APIs.</p>

<p>2 - By subclassing the <code>Model</code> class: in that case, you should define your
layers in <code><a href="#SavableModel.__init__">__init__()</a></code> and you should implement the model's forward pass
in <code><a href="#SavableModel.call">call()</a></code>.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>If you subclass <code>Model</code>, you can optionally have
a <code>training</code> argument (boolean) in <code><a href="#SavableModel.call">call()</a></code>, which you can use to specify
a different behavior in training and inference:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>Once the model is created, you can config the model with losses and metrics
with <code>model.compile()</code>, train the model with <code>model.fit()</code>, or use the model
to do prediction with <code>model.predict()</code>.</p>
</div>


                            <div id="SavableModel.__init__" class="classattr">
                                        <input id="SavableModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SavableModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="SavableModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SavableModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SavableModel.__init__-110"><a href="#SavableModel.__init__-110"><span class="linenos">110</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SavableModel.__init__-111"><a href="#SavableModel.__init__-111"><span class="linenos">111</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="SavableModel.save" class="classattr">
                                        <input id="SavableModel.save-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">save</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">base_path</span><span class="o">=</span><span class="s1">&#39;.polus_cache/saved_models&#39;</span>, </span><span class="param"><span class="n">extension</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span>)</span>

                <label class="view-source-button" for="SavableModel.save-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SavableModel.save"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SavableModel.save-113"><a href="#SavableModel.save-113"><span class="linenos">113</span></a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="SavableModel.save-114"><a href="#SavableModel.save-114"><span class="linenos">114</span></a>             <span class="n">base_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;.polus_cache&quot;</span><span class="p">,</span><span class="s2">&quot;saved_models&quot;</span><span class="p">),</span> 
</span><span id="SavableModel.save-115"><a href="#SavableModel.save-115"><span class="linenos">115</span></a>             <span class="n">extension</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="SavableModel.save-116"><a href="#SavableModel.save-116"><span class="linenos">116</span></a>        
</span><span id="SavableModel.save-117"><a href="#SavableModel.save-117"><span class="linenos">117</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_path</span><span class="p">):</span>
</span><span id="SavableModel.save-118"><a href="#SavableModel.save-118"><span class="linenos">118</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">base_path</span><span class="p">)</span>
</span><span id="SavableModel.save-119"><a href="#SavableModel.save-119"><span class="linenos">119</span></a>        
</span><span id="SavableModel.save-120"><a href="#SavableModel.save-120"><span class="linenos">120</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">+</span><span class="n">extension</span><span class="p">)</span>
</span><span id="SavableModel.save-121"><a href="#SavableModel.save-121"><span class="linenos">121</span></a>        
</span><span id="SavableModel.save-122"><a href="#SavableModel.save-122"><span class="linenos">122</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.cfg&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel.save-123"><a href="#SavableModel.save-123"><span class="linenos">123</span></a>            <span class="n">json_str</span> <span class="o">=</span> <span class="n">complex_json_serializer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">savable_config</span><span class="p">)</span>
</span><span id="SavableModel.save-124"><a href="#SavableModel.save-124"><span class="linenos">124</span></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_str</span> <span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="SavableModel.save-125"><a href="#SavableModel.save-125"><span class="linenos">125</span></a>        
</span><span id="SavableModel.save-126"><a href="#SavableModel.save-126"><span class="linenos">126</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_init&quot;</span><span class="p">):</span>
</span><span id="SavableModel.save-127"><a href="#SavableModel.save-127"><span class="linenos">127</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.init&quot;</span><span class="p">,</span><span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel.save-128"><a href="#SavableModel.save-128"><span class="linenos">128</span></a>                <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span><span id="SavableModel.save-129"><a href="#SavableModel.save-129"><span class="linenos">129</span></a>        
</span><span id="SavableModel.save-130"><a href="#SavableModel.save-130"><span class="linenos">130</span></a>        <span class="c1">#save model weights</span>
</span><span id="SavableModel.save-131"><a href="#SavableModel.save-131"><span class="linenos">131</span></a>        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">path</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="SavableModel.save-132"><a href="#SavableModel.save-132"><span class="linenos">132</span></a>            <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>
</span><span id="SavableModel.save-133"><a href="#SavableModel.save-133"><span class="linenos">133</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">weight</span><span class="p">)):</span>
</span><span id="SavableModel.save-134"><a href="#SavableModel.save-134"><span class="linenos">134</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Saves the model to Tensorflow SavedModel or a single HDF5 file.</p>

<p>Please see <code>tf.keras.models.save_model</code> or the
<a href="https://keras.io/guides/serialization_and_saving/">Serialization and Saving guide</a>
for details.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>filepath:</strong>  String, PathLike, path to SavedModel or H5 file to save the
model.</li>
<li><strong>overwrite:</strong>  Whether to silently overwrite any existing file at the
target location, or provide the user with a manual prompt.</li>
<li><strong>include_optimizer:</strong>  If True, save optimizer's state together.</li>
<li><strong>save_format:</strong>  Either <code>'tf'</code> or <code>'h5'</code>, indicating whether to save the
model to Tensorflow SavedModel or HDF5. Defaults to 'tf' in TF 2.X,
and 'h5' in TF 1.X.</li>
<li><strong>signatures:</strong>  Signatures to save with the SavedModel. Applicable to the
'tf' format only. Please see the <code>signatures</code> argument in
<code>tf.saved_model.save</code> for details.</li>
<li><strong>options:</strong>  (only applies to SavedModel format)
<code>tf.saved_model.SaveOptions</code> object that specifies options for
saving to SavedModel.</li>
<li><strong>save_traces:</strong>  (only applies to SavedModel format) When enabled, the
SavedModel will store the function traces for each layer. This
can be disabled, so that only the configs of each layer are stored.
Defaults to <code>True</code>. Disabling this will decrease serialization time
and reduce file size, but it requires that all custom layers/models
implement a <code><a href="#SavableModel.get_config">get_config()</a></code> method.</li>
</ul>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">load_model</span>

<span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;my_model.h5&#39;</span><span class="p">)</span>  <span class="c1"># creates a HDF5 file &#39;my_model.h5&#39;</span>
<span class="k">del</span> <span class="n">model</span>  <span class="c1"># deletes the existing model</span>

<span class="c1"># returns a compiled model</span>
<span class="c1"># identical to the previous one</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="s1">&#39;my_model.h5&#39;</span><span class="p">)</span>
</code></pre></div>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#PolusModel">PolusModel</a></dt>
                                <dd id="SavableModel.init_from_data" class="function"><a href="#PolusModel.init_from_data">init_from_data</a></dd>
                <dd id="SavableModel.set_name" class="function"><a href="#PolusModel.set_name">set_name</a></dd>

            </div>
            <div><dt>keras.engine.training.Model</dt>
                                <dd id="SavableModel.build" class="function">build</dd>
                <dd id="SavableModel.call" class="function">call</dd>
                <dd id="SavableModel.compile" class="function">compile</dd>
                <dd id="SavableModel.metrics" class="variable">metrics</dd>
                <dd id="SavableModel.metrics_names" class="variable">metrics_names</dd>
                <dd id="SavableModel.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="SavableModel.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="SavableModel.train_step" class="function">train_step</dd>
                <dd id="SavableModel.compute_loss" class="function">compute_loss</dd>
                <dd id="SavableModel.compute_metrics" class="function">compute_metrics</dd>
                <dd id="SavableModel.make_train_function" class="function">make_train_function</dd>
                <dd id="SavableModel.fit" class="function">fit</dd>
                <dd id="SavableModel.test_step" class="function">test_step</dd>
                <dd id="SavableModel.make_test_function" class="function">make_test_function</dd>
                <dd id="SavableModel.evaluate" class="function">evaluate</dd>
                <dd id="SavableModel.predict_step" class="function">predict_step</dd>
                <dd id="SavableModel.make_predict_function" class="function">make_predict_function</dd>
                <dd id="SavableModel.predict" class="function">predict</dd>
                <dd id="SavableModel.reset_metrics" class="function">reset_metrics</dd>
                <dd id="SavableModel.train_on_batch" class="function">train_on_batch</dd>
                <dd id="SavableModel.test_on_batch" class="function">test_on_batch</dd>
                <dd id="SavableModel.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="SavableModel.fit_generator" class="function">fit_generator</dd>
                <dd id="SavableModel.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="SavableModel.predict_generator" class="function">predict_generator</dd>
                <dd id="SavableModel.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="SavableModel.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="SavableModel.get_weights" class="function">get_weights</dd>
                <dd id="SavableModel.save_weights" class="function">save_weights</dd>
                <dd id="SavableModel.load_weights" class="function">load_weights</dd>
                <dd id="SavableModel.get_config" class="function">get_config</dd>
                <dd id="SavableModel.from_config" class="function">from_config</dd>
                <dd id="SavableModel.to_json" class="function">to_json</dd>
                <dd id="SavableModel.to_yaml" class="function">to_yaml</dd>
                <dd id="SavableModel.reset_states" class="function">reset_states</dd>
                <dd id="SavableModel.state_updates" class="variable">state_updates</dd>
                <dd id="SavableModel.weights" class="variable">weights</dd>
                <dd id="SavableModel.summary" class="function">summary</dd>
                <dd id="SavableModel.layers" class="variable">layers</dd>
                <dd id="SavableModel.get_layer" class="function">get_layer</dd>
                <dd id="SavableModel.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="SavableModel.add_weight" class="function">add_weight</dd>
                <dd id="SavableModel.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="SavableModel.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="SavableModel.compute_mask" class="function">compute_mask</dd>
                <dd id="SavableModel.dtype" class="variable">dtype</dd>
                <dd id="SavableModel.name" class="variable">name</dd>
                <dd id="SavableModel.supports_masking" class="variable">supports_masking</dd>
                <dd id="SavableModel.dynamic" class="variable">dynamic</dd>
                <dd id="SavableModel.stateful" class="variable">stateful</dd>
                <dd id="SavableModel.trainable" class="variable">trainable</dd>
                <dd id="SavableModel.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="SavableModel.input_spec" class="variable">input_spec</dd>
                <dd id="SavableModel.updates" class="variable">updates</dd>
                <dd id="SavableModel.losses" class="variable">losses</dd>
                <dd id="SavableModel.add_loss" class="function">add_loss</dd>
                <dd id="SavableModel.add_metric" class="function">add_metric</dd>
                <dd id="SavableModel.add_update" class="function">add_update</dd>
                <dd id="SavableModel.set_weights" class="function">set_weights</dd>
                <dd id="SavableModel.finalize_state" class="function">finalize_state</dd>
                <dd id="SavableModel.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="SavableModel.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="SavableModel.input_mask" class="variable">input_mask</dd>
                <dd id="SavableModel.output_mask" class="variable">output_mask</dd>
                <dd id="SavableModel.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="SavableModel.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="SavableModel.get_input_at" class="function">get_input_at</dd>
                <dd id="SavableModel.get_output_at" class="function">get_output_at</dd>
                <dd id="SavableModel.input" class="variable">input</dd>
                <dd id="SavableModel.output" class="variable">output</dd>
                <dd id="SavableModel.input_shape" class="variable">input_shape</dd>
                <dd id="SavableModel.count_params" class="function">count_params</dd>
                <dd id="SavableModel.output_shape" class="variable">output_shape</dd>
                <dd id="SavableModel.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="SavableModel.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="SavableModel.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="SavableModel.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="SavableModel.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="SavableModel.variables" class="variable">variables</dd>
                <dd id="SavableModel.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="SavableModel.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="SavableModel.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="SavableModel.name_scope" class="variable">name_scope</dd>
                <dd id="SavableModel.submodules" class="variable">submodules</dd>
                <dd id="SavableModel.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SequentialSavableModel">
                            <input id="SequentialSavableModel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SequentialSavableModel</span><wbr>(<span class="base">keras.engine.sequential.Sequential</span>, <span class="base"><a href="#SavableModel">SavableModel</a></span>):

                <label class="view-source-button" for="SequentialSavableModel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequentialSavableModel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequentialSavableModel-136"><a href="#SequentialSavableModel-136"><span class="linenos">136</span></a><span class="k">class</span> <span class="nc">SequentialSavableModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">SavableModel</span><span class="p">):</span>
</span><span id="SequentialSavableModel-137"><a href="#SequentialSavableModel-137"><span class="linenos">137</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="SequentialSavableModel-138"><a href="#SequentialSavableModel-138"><span class="linenos">138</span></a><span class="sd">    This class is just to be compatible with the Sequential Model from keras and implements</span>
</span><span id="SequentialSavableModel-139"><a href="#SequentialSavableModel-139"><span class="linenos">139</span></a><span class="sd">    the same inference method from the SavableModel class</span>
</span><span id="SequentialSavableModel-140"><a href="#SequentialSavableModel-140"><span class="linenos">140</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="SequentialSavableModel-141"><a href="#SequentialSavableModel-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SequentialSavableModel-142"><a href="#SequentialSavableModel-142"><span class="linenos">142</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This class is just to be compatible with the Sequential Model from keras and implements
the same inference method from the SavableModel class</p>
</div>


                            <div id="SequentialSavableModel.__init__" class="classattr">
                                        <input id="SequentialSavableModel.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SequentialSavableModel</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">layers</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="SequentialSavableModel.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequentialSavableModel.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequentialSavableModel.__init__-141"><a href="#SequentialSavableModel.__init__-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SequentialSavableModel.__init__-142"><a href="#SequentialSavableModel.__init__-142"><span class="linenos">142</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code>Sequential</code> model instance.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>layers:</strong>  Optional list of layers to add to the model.</li>
<li><strong>name:</strong>  Optional name for the model.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="SequentialSavableModel.supports_masking" class="variable">supports_masking</dd>
                <dd id="SequentialSavableModel.add_weight" class="function">add_weight</dd>
                <dd id="SequentialSavableModel.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="SequentialSavableModel.dtype" class="variable">dtype</dd>
                <dd id="SequentialSavableModel.name" class="variable">name</dd>
                <dd id="SequentialSavableModel.dynamic" class="variable">dynamic</dd>
                <dd id="SequentialSavableModel.stateful" class="variable">stateful</dd>
                <dd id="SequentialSavableModel.trainable" class="variable">trainable</dd>
                <dd id="SequentialSavableModel.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="SequentialSavableModel.updates" class="variable">updates</dd>
                <dd id="SequentialSavableModel.losses" class="variable">losses</dd>
                <dd id="SequentialSavableModel.add_loss" class="function">add_loss</dd>
                <dd id="SequentialSavableModel.add_metric" class="function">add_metric</dd>
                <dd id="SequentialSavableModel.add_update" class="function">add_update</dd>
                <dd id="SequentialSavableModel.set_weights" class="function">set_weights</dd>
                <dd id="SequentialSavableModel.finalize_state" class="function">finalize_state</dd>
                <dd id="SequentialSavableModel.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="SequentialSavableModel.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="SequentialSavableModel.input_mask" class="variable">input_mask</dd>
                <dd id="SequentialSavableModel.output_mask" class="variable">output_mask</dd>
                <dd id="SequentialSavableModel.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="SequentialSavableModel.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="SequentialSavableModel.get_input_at" class="function">get_input_at</dd>
                <dd id="SequentialSavableModel.get_output_at" class="function">get_output_at</dd>
                <dd id="SequentialSavableModel.count_params" class="function">count_params</dd>
                <dd id="SequentialSavableModel.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="SequentialSavableModel.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="SequentialSavableModel.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="SequentialSavableModel.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="SequentialSavableModel.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="SequentialSavableModel.variables" class="variable">variables</dd>
                <dd id="SequentialSavableModel.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="SequentialSavableModel.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="SequentialSavableModel.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>keras.engine.sequential.Sequential</dt>
                                <dd id="SequentialSavableModel.layers" class="variable">layers</dd>
                <dd id="SequentialSavableModel.add" class="function">add</dd>
                <dd id="SequentialSavableModel.pop" class="function">pop</dd>
                <dd id="SequentialSavableModel.build" class="function">build</dd>
                <dd id="SequentialSavableModel.call" class="function">call</dd>
                <dd id="SequentialSavableModel.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="SequentialSavableModel.compute_mask" class="function">compute_mask</dd>
                <dd id="SequentialSavableModel.get_config" class="function">get_config</dd>
                <dd id="SequentialSavableModel.from_config" class="function">from_config</dd>
                <dd id="SequentialSavableModel.input_spec" class="variable">input_spec</dd>

            </div>
            <div><dt>keras.engine.functional.Functional</dt>
                                <dd id="SequentialSavableModel.input" class="variable">input</dd>
                <dd id="SequentialSavableModel.input_shape" class="variable">input_shape</dd>
                <dd id="SequentialSavableModel.output" class="variable">output</dd>
                <dd id="SequentialSavableModel.output_shape" class="variable">output_shape</dd>

            </div>
            <div><dt><a href="#SavableModel">SavableModel</a></dt>
                                <dd id="SequentialSavableModel.save" class="function"><a href="#SavableModel.save">save</a></dd>

            </div>
            <div><dt><a href="#PolusModel">PolusModel</a></dt>
                                <dd id="SequentialSavableModel.init_from_data" class="function"><a href="#PolusModel.init_from_data">init_from_data</a></dd>
                <dd id="SequentialSavableModel.set_name" class="function"><a href="#PolusModel.set_name">set_name</a></dd>

            </div>
            <div><dt>keras.engine.training.Model</dt>
                                <dd id="SequentialSavableModel.compile" class="function">compile</dd>
                <dd id="SequentialSavableModel.metrics" class="variable">metrics</dd>
                <dd id="SequentialSavableModel.metrics_names" class="variable">metrics_names</dd>
                <dd id="SequentialSavableModel.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="SequentialSavableModel.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="SequentialSavableModel.train_step" class="function">train_step</dd>
                <dd id="SequentialSavableModel.compute_loss" class="function">compute_loss</dd>
                <dd id="SequentialSavableModel.compute_metrics" class="function">compute_metrics</dd>
                <dd id="SequentialSavableModel.make_train_function" class="function">make_train_function</dd>
                <dd id="SequentialSavableModel.fit" class="function">fit</dd>
                <dd id="SequentialSavableModel.test_step" class="function">test_step</dd>
                <dd id="SequentialSavableModel.make_test_function" class="function">make_test_function</dd>
                <dd id="SequentialSavableModel.evaluate" class="function">evaluate</dd>
                <dd id="SequentialSavableModel.predict_step" class="function">predict_step</dd>
                <dd id="SequentialSavableModel.make_predict_function" class="function">make_predict_function</dd>
                <dd id="SequentialSavableModel.predict" class="function">predict</dd>
                <dd id="SequentialSavableModel.reset_metrics" class="function">reset_metrics</dd>
                <dd id="SequentialSavableModel.train_on_batch" class="function">train_on_batch</dd>
                <dd id="SequentialSavableModel.test_on_batch" class="function">test_on_batch</dd>
                <dd id="SequentialSavableModel.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="SequentialSavableModel.fit_generator" class="function">fit_generator</dd>
                <dd id="SequentialSavableModel.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="SequentialSavableModel.predict_generator" class="function">predict_generator</dd>
                <dd id="SequentialSavableModel.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="SequentialSavableModel.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="SequentialSavableModel.get_weights" class="function">get_weights</dd>
                <dd id="SequentialSavableModel.save_weights" class="function">save_weights</dd>
                <dd id="SequentialSavableModel.load_weights" class="function">load_weights</dd>
                <dd id="SequentialSavableModel.to_json" class="function">to_json</dd>
                <dd id="SequentialSavableModel.to_yaml" class="function">to_yaml</dd>
                <dd id="SequentialSavableModel.reset_states" class="function">reset_states</dd>
                <dd id="SequentialSavableModel.state_updates" class="variable">state_updates</dd>
                <dd id="SequentialSavableModel.weights" class="variable">weights</dd>
                <dd id="SequentialSavableModel.summary" class="function">summary</dd>
                <dd id="SequentialSavableModel.get_layer" class="function">get_layer</dd>
                <dd id="SequentialSavableModel.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="SequentialSavableModel.name_scope" class="variable">name_scope</dd>
                <dd id="SequentialSavableModel.submodules" class="variable">submodules</dd>
                <dd id="SequentialSavableModel.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="PolusClassifier">
                            <input id="PolusClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PolusClassifier</span><wbr>(<span class="base"><a href="#SavableModel">SavableModel</a></span>):

                <label class="view-source-button" for="PolusClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusClassifier-144"><a href="#PolusClassifier-144"><span class="linenos">144</span></a><span class="k">class</span> <span class="nc">PolusClassifier</span><span class="p">(</span><span class="n">SavableModel</span><span class="p">):</span>
</span><span id="PolusClassifier-145"><a href="#PolusClassifier-145"><span class="linenos">145</span></a>    
</span><span id="PolusClassifier-146"><a href="#PolusClassifier-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusClassifier-147"><a href="#PolusClassifier-147"><span class="linenos">147</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="PolusClassifier-148"><a href="#PolusClassifier-148"><span class="linenos">148</span></a>    
</span><span id="PolusClassifier-149"><a href="#PolusClassifier-149"><span class="linenos">149</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
</span><span id="PolusClassifier-150"><a href="#PolusClassifier-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="PolusClassifier-151"><a href="#PolusClassifier-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p><code>Model</code> groups layers into an object with training and inference features.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>inputs:</strong>  The input(s) of the model: a <code>keras.Input</code> object or list of
<code>keras.Input</code> objects.</li>
<li><strong>outputs:</strong>  The output(s) of the model. See Functional API example below.</li>
<li><strong>name:</strong>  String, the name of the model.</li>
</ul>

<p>There are two ways to instantiate a <code>Model</code>:</p>

<p>1 - With the "Functional API", where you start from <code>Input</code>,
you chain layer calls to specify the model's forward pass,
and finally you create your model from inputs and outputs:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div>

<p>Note: Only dicts, lists, and tuples of input tensors are supported. Nested
inputs are not supported (e.g. lists of list or dicts of dict).</p>

<p>A new Functional API model can also be created by using the
intermediate tensors. This enables you to quickly extract sub-components
of the model.</p>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">processed</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">32</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="n">processed</span><span class="p">)</span>
<span class="n">pooling</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="n">pooling</span><span class="p">)</span>

<span class="n">full_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
<span class="n">backbone</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
<span class="n">activations</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
</code></pre></div>

<p>Note that the <code>backbone</code> and <code>activations</code> models are not
created with <code>keras.Input</code> objects, but with the tensors that are originated
from <code>keras.Inputs</code> objects. Under the hood, the layers and weights will
be shared across these models, so that user can train the <code>full_model</code>, and
use <code>backbone</code> or <code>activations</code> to do feature extraction.
The inputs and outputs of the model can be nested structures of tensors as
well, and the created models are standard Functional API models that support
all the existing APIs.</p>

<p>2 - By subclassing the <code>Model</code> class: in that case, you should define your
layers in <code><a href="#PolusClassifier.__init__">__init__()</a></code> and you should implement the model's forward pass
in <code><a href="#PolusClassifier.call">call()</a></code>.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>If you subclass <code>Model</code>, you can optionally have
a <code>training</code> argument (boolean) in <code><a href="#PolusClassifier.call">call()</a></code>, which you can use to specify
a different behavior in training and inference:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>Once the model is created, you can config the model with losses and metrics
with <code>model.compile()</code>, train the model with <code>model.fit()</code>, or use the model
to do prediction with <code>model.predict()</code>.</p>
</div>


                            <div id="PolusClassifier.__init__" class="classattr">
                                        <input id="PolusClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">PolusClassifier</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="PolusClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusClassifier.__init__-146"><a href="#PolusClassifier.__init__-146"><span class="linenos">146</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="PolusClassifier.__init__-147"><a href="#PolusClassifier.__init__-147"><span class="linenos">147</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div id="PolusClassifier.inference" class="classattr">
                                        <input id="PolusClassifier.inference-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@tf.function</div>

        <span class="def">def</span>
        <span class="name">inference</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">x</span></span>)</span>

                <label class="view-source-button" for="PolusClassifier.inference-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PolusClassifier.inference"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PolusClassifier.inference-149"><a href="#PolusClassifier.inference-149"><span class="linenos">149</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span>
</span><span id="PolusClassifier.inference-150"><a href="#PolusClassifier.inference-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">inference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="PolusClassifier.inference-151"><a href="#PolusClassifier.inference-151"><span class="linenos">151</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="bp">self</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#SavableModel">SavableModel</a></dt>
                                <dd id="PolusClassifier.save" class="function"><a href="#SavableModel.save">save</a></dd>

            </div>
            <div><dt><a href="#PolusModel">PolusModel</a></dt>
                                <dd id="PolusClassifier.init_from_data" class="function"><a href="#PolusModel.init_from_data">init_from_data</a></dd>
                <dd id="PolusClassifier.set_name" class="function"><a href="#PolusModel.set_name">set_name</a></dd>

            </div>
            <div><dt>keras.engine.training.Model</dt>
                                <dd id="PolusClassifier.build" class="function">build</dd>
                <dd id="PolusClassifier.call" class="function">call</dd>
                <dd id="PolusClassifier.compile" class="function">compile</dd>
                <dd id="PolusClassifier.metrics" class="variable">metrics</dd>
                <dd id="PolusClassifier.metrics_names" class="variable">metrics_names</dd>
                <dd id="PolusClassifier.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="PolusClassifier.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="PolusClassifier.train_step" class="function">train_step</dd>
                <dd id="PolusClassifier.compute_loss" class="function">compute_loss</dd>
                <dd id="PolusClassifier.compute_metrics" class="function">compute_metrics</dd>
                <dd id="PolusClassifier.make_train_function" class="function">make_train_function</dd>
                <dd id="PolusClassifier.fit" class="function">fit</dd>
                <dd id="PolusClassifier.test_step" class="function">test_step</dd>
                <dd id="PolusClassifier.make_test_function" class="function">make_test_function</dd>
                <dd id="PolusClassifier.evaluate" class="function">evaluate</dd>
                <dd id="PolusClassifier.predict_step" class="function">predict_step</dd>
                <dd id="PolusClassifier.make_predict_function" class="function">make_predict_function</dd>
                <dd id="PolusClassifier.predict" class="function">predict</dd>
                <dd id="PolusClassifier.reset_metrics" class="function">reset_metrics</dd>
                <dd id="PolusClassifier.train_on_batch" class="function">train_on_batch</dd>
                <dd id="PolusClassifier.test_on_batch" class="function">test_on_batch</dd>
                <dd id="PolusClassifier.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="PolusClassifier.fit_generator" class="function">fit_generator</dd>
                <dd id="PolusClassifier.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="PolusClassifier.predict_generator" class="function">predict_generator</dd>
                <dd id="PolusClassifier.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="PolusClassifier.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="PolusClassifier.get_weights" class="function">get_weights</dd>
                <dd id="PolusClassifier.save_weights" class="function">save_weights</dd>
                <dd id="PolusClassifier.load_weights" class="function">load_weights</dd>
                <dd id="PolusClassifier.get_config" class="function">get_config</dd>
                <dd id="PolusClassifier.from_config" class="function">from_config</dd>
                <dd id="PolusClassifier.to_json" class="function">to_json</dd>
                <dd id="PolusClassifier.to_yaml" class="function">to_yaml</dd>
                <dd id="PolusClassifier.reset_states" class="function">reset_states</dd>
                <dd id="PolusClassifier.state_updates" class="variable">state_updates</dd>
                <dd id="PolusClassifier.weights" class="variable">weights</dd>
                <dd id="PolusClassifier.summary" class="function">summary</dd>
                <dd id="PolusClassifier.layers" class="variable">layers</dd>
                <dd id="PolusClassifier.get_layer" class="function">get_layer</dd>
                <dd id="PolusClassifier.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="PolusClassifier.add_weight" class="function">add_weight</dd>
                <dd id="PolusClassifier.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="PolusClassifier.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="PolusClassifier.compute_mask" class="function">compute_mask</dd>
                <dd id="PolusClassifier.dtype" class="variable">dtype</dd>
                <dd id="PolusClassifier.name" class="variable">name</dd>
                <dd id="PolusClassifier.supports_masking" class="variable">supports_masking</dd>
                <dd id="PolusClassifier.dynamic" class="variable">dynamic</dd>
                <dd id="PolusClassifier.stateful" class="variable">stateful</dd>
                <dd id="PolusClassifier.trainable" class="variable">trainable</dd>
                <dd id="PolusClassifier.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="PolusClassifier.input_spec" class="variable">input_spec</dd>
                <dd id="PolusClassifier.updates" class="variable">updates</dd>
                <dd id="PolusClassifier.losses" class="variable">losses</dd>
                <dd id="PolusClassifier.add_loss" class="function">add_loss</dd>
                <dd id="PolusClassifier.add_metric" class="function">add_metric</dd>
                <dd id="PolusClassifier.add_update" class="function">add_update</dd>
                <dd id="PolusClassifier.set_weights" class="function">set_weights</dd>
                <dd id="PolusClassifier.finalize_state" class="function">finalize_state</dd>
                <dd id="PolusClassifier.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="PolusClassifier.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="PolusClassifier.input_mask" class="variable">input_mask</dd>
                <dd id="PolusClassifier.output_mask" class="variable">output_mask</dd>
                <dd id="PolusClassifier.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="PolusClassifier.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="PolusClassifier.get_input_at" class="function">get_input_at</dd>
                <dd id="PolusClassifier.get_output_at" class="function">get_output_at</dd>
                <dd id="PolusClassifier.input" class="variable">input</dd>
                <dd id="PolusClassifier.output" class="variable">output</dd>
                <dd id="PolusClassifier.input_shape" class="variable">input_shape</dd>
                <dd id="PolusClassifier.count_params" class="function">count_params</dd>
                <dd id="PolusClassifier.output_shape" class="variable">output_shape</dd>
                <dd id="PolusClassifier.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="PolusClassifier.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="PolusClassifier.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="PolusClassifier.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="PolusClassifier.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="PolusClassifier.variables" class="variable">variables</dd>
                <dd id="PolusClassifier.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="PolusClassifier.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="PolusClassifier.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="PolusClassifier.name_scope" class="variable">name_scope</dd>
                <dd id="PolusClassifier.submodules" class="variable">submodules</dd>
                <dd id="PolusClassifier.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="SequentialPolusClassifier">
                            <input id="SequentialPolusClassifier-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SequentialPolusClassifier</span><wbr>(<span class="base">keras.engine.sequential.Sequential</span>, <span class="base"><a href="#PolusClassifier">PolusClassifier</a></span>):

                <label class="view-source-button" for="SequentialPolusClassifier-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequentialPolusClassifier"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequentialPolusClassifier-153"><a href="#SequentialPolusClassifier-153"><span class="linenos">153</span></a><span class="k">class</span> <span class="nc">SequentialPolusClassifier</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">,</span> <span class="n">PolusClassifier</span><span class="p">):</span>
</span><span id="SequentialPolusClassifier-154"><a href="#SequentialPolusClassifier-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SequentialPolusClassifier-155"><a href="#SequentialPolusClassifier-155"><span class="linenos">155</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p><code>Sequential</code> groups a linear stack of layers into a <code>tf.keras.Model</code>.</p>

<p><code>Sequential</code> provides training and inference features on this model.</p>

<p>Examples:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="c1"># Optionally, the first layer can receive an `input_shape` argument:</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,)))</span>
<span class="c1"># Afterwards, we do automatic shape inference:</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>

<span class="c1"># This is identical to the following:</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Note that you can also omit the `input_shape` argument.</span>
<span class="c1"># In that case the model doesn&#39;t have any weights until the first call</span>
<span class="c1"># to a training/evaluation method (since it isn&#39;t yet built):</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="c1"># model.weights not created yet</span>

<span class="c1"># Whereas if you specify the input shape, the model gets built</span>
<span class="c1"># continuously as you are adding layers:</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,)))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="c1"># Returns &quot;4&quot;</span>

<span class="c1"># When using the delayed-build pattern (no input shape specified), you can</span>
<span class="c1"># choose to manually build your model by calling</span>
<span class="c1"># `build(batch_input_shape)`:</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">build</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">weights</span><span class="p">)</span>
<span class="c1"># Returns &quot;4&quot;</span>

<span class="c1"># Note that when using the delayed-build pattern (no input shape specified),</span>
<span class="c1"># the model gets built the first time you call `fit`, `eval`, or `predict`,</span>
<span class="c1"># or the first time you call the model on some input data.</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;sgd&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="c1"># This builds the model for the first time:</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
</div>


                            <div id="SequentialPolusClassifier.__init__" class="classattr">
                                        <input id="SequentialPolusClassifier.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">SequentialPolusClassifier</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">layers</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="SequentialPolusClassifier.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SequentialPolusClassifier.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SequentialPolusClassifier.__init__-154"><a href="#SequentialPolusClassifier.__init__-154"><span class="linenos">154</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="SequentialPolusClassifier.__init__-155"><a href="#SequentialPolusClassifier.__init__-155"><span class="linenos">155</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a <code>Sequential</code> model instance.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>layers:</strong>  Optional list of layers to add to the model.</li>
<li><strong>name:</strong>  Optional name for the model.</li>
</ul>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="SequentialPolusClassifier.supports_masking" class="variable">supports_masking</dd>
                <dd id="SequentialPolusClassifier.add_weight" class="function">add_weight</dd>
                <dd id="SequentialPolusClassifier.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="SequentialPolusClassifier.dtype" class="variable">dtype</dd>
                <dd id="SequentialPolusClassifier.name" class="variable">name</dd>
                <dd id="SequentialPolusClassifier.dynamic" class="variable">dynamic</dd>
                <dd id="SequentialPolusClassifier.stateful" class="variable">stateful</dd>
                <dd id="SequentialPolusClassifier.trainable" class="variable">trainable</dd>
                <dd id="SequentialPolusClassifier.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="SequentialPolusClassifier.updates" class="variable">updates</dd>
                <dd id="SequentialPolusClassifier.losses" class="variable">losses</dd>
                <dd id="SequentialPolusClassifier.add_loss" class="function">add_loss</dd>
                <dd id="SequentialPolusClassifier.add_metric" class="function">add_metric</dd>
                <dd id="SequentialPolusClassifier.add_update" class="function">add_update</dd>
                <dd id="SequentialPolusClassifier.set_weights" class="function">set_weights</dd>
                <dd id="SequentialPolusClassifier.finalize_state" class="function">finalize_state</dd>
                <dd id="SequentialPolusClassifier.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="SequentialPolusClassifier.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="SequentialPolusClassifier.input_mask" class="variable">input_mask</dd>
                <dd id="SequentialPolusClassifier.output_mask" class="variable">output_mask</dd>
                <dd id="SequentialPolusClassifier.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="SequentialPolusClassifier.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="SequentialPolusClassifier.get_input_at" class="function">get_input_at</dd>
                <dd id="SequentialPolusClassifier.get_output_at" class="function">get_output_at</dd>
                <dd id="SequentialPolusClassifier.count_params" class="function">count_params</dd>
                <dd id="SequentialPolusClassifier.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="SequentialPolusClassifier.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="SequentialPolusClassifier.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="SequentialPolusClassifier.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="SequentialPolusClassifier.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="SequentialPolusClassifier.variables" class="variable">variables</dd>
                <dd id="SequentialPolusClassifier.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="SequentialPolusClassifier.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="SequentialPolusClassifier.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>keras.engine.sequential.Sequential</dt>
                                <dd id="SequentialPolusClassifier.layers" class="variable">layers</dd>
                <dd id="SequentialPolusClassifier.add" class="function">add</dd>
                <dd id="SequentialPolusClassifier.pop" class="function">pop</dd>
                <dd id="SequentialPolusClassifier.build" class="function">build</dd>
                <dd id="SequentialPolusClassifier.call" class="function">call</dd>
                <dd id="SequentialPolusClassifier.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="SequentialPolusClassifier.compute_mask" class="function">compute_mask</dd>
                <dd id="SequentialPolusClassifier.get_config" class="function">get_config</dd>
                <dd id="SequentialPolusClassifier.from_config" class="function">from_config</dd>
                <dd id="SequentialPolusClassifier.input_spec" class="variable">input_spec</dd>

            </div>
            <div><dt>keras.engine.functional.Functional</dt>
                                <dd id="SequentialPolusClassifier.input" class="variable">input</dd>
                <dd id="SequentialPolusClassifier.input_shape" class="variable">input_shape</dd>
                <dd id="SequentialPolusClassifier.output" class="variable">output</dd>
                <dd id="SequentialPolusClassifier.output_shape" class="variable">output_shape</dd>

            </div>
            <div><dt><a href="#PolusClassifier">PolusClassifier</a></dt>
                                <dd id="SequentialPolusClassifier.inference" class="function"><a href="#PolusClassifier.inference">inference</a></dd>

            </div>
            <div><dt><a href="#SavableModel">SavableModel</a></dt>
                                <dd id="SequentialPolusClassifier.save" class="function"><a href="#SavableModel.save">save</a></dd>

            </div>
            <div><dt><a href="#PolusModel">PolusModel</a></dt>
                                <dd id="SequentialPolusClassifier.init_from_data" class="function"><a href="#PolusModel.init_from_data">init_from_data</a></dd>
                <dd id="SequentialPolusClassifier.set_name" class="function"><a href="#PolusModel.set_name">set_name</a></dd>

            </div>
            <div><dt>keras.engine.training.Model</dt>
                                <dd id="SequentialPolusClassifier.compile" class="function">compile</dd>
                <dd id="SequentialPolusClassifier.metrics" class="variable">metrics</dd>
                <dd id="SequentialPolusClassifier.metrics_names" class="variable">metrics_names</dd>
                <dd id="SequentialPolusClassifier.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="SequentialPolusClassifier.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="SequentialPolusClassifier.train_step" class="function">train_step</dd>
                <dd id="SequentialPolusClassifier.compute_loss" class="function">compute_loss</dd>
                <dd id="SequentialPolusClassifier.compute_metrics" class="function">compute_metrics</dd>
                <dd id="SequentialPolusClassifier.make_train_function" class="function">make_train_function</dd>
                <dd id="SequentialPolusClassifier.fit" class="function">fit</dd>
                <dd id="SequentialPolusClassifier.test_step" class="function">test_step</dd>
                <dd id="SequentialPolusClassifier.make_test_function" class="function">make_test_function</dd>
                <dd id="SequentialPolusClassifier.evaluate" class="function">evaluate</dd>
                <dd id="SequentialPolusClassifier.predict_step" class="function">predict_step</dd>
                <dd id="SequentialPolusClassifier.make_predict_function" class="function">make_predict_function</dd>
                <dd id="SequentialPolusClassifier.predict" class="function">predict</dd>
                <dd id="SequentialPolusClassifier.reset_metrics" class="function">reset_metrics</dd>
                <dd id="SequentialPolusClassifier.train_on_batch" class="function">train_on_batch</dd>
                <dd id="SequentialPolusClassifier.test_on_batch" class="function">test_on_batch</dd>
                <dd id="SequentialPolusClassifier.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="SequentialPolusClassifier.fit_generator" class="function">fit_generator</dd>
                <dd id="SequentialPolusClassifier.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="SequentialPolusClassifier.predict_generator" class="function">predict_generator</dd>
                <dd id="SequentialPolusClassifier.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="SequentialPolusClassifier.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="SequentialPolusClassifier.get_weights" class="function">get_weights</dd>
                <dd id="SequentialPolusClassifier.save_weights" class="function">save_weights</dd>
                <dd id="SequentialPolusClassifier.load_weights" class="function">load_weights</dd>
                <dd id="SequentialPolusClassifier.to_json" class="function">to_json</dd>
                <dd id="SequentialPolusClassifier.to_yaml" class="function">to_yaml</dd>
                <dd id="SequentialPolusClassifier.reset_states" class="function">reset_states</dd>
                <dd id="SequentialPolusClassifier.state_updates" class="variable">state_updates</dd>
                <dd id="SequentialPolusClassifier.weights" class="variable">weights</dd>
                <dd id="SequentialPolusClassifier.summary" class="function">summary</dd>
                <dd id="SequentialPolusClassifier.get_layer" class="function">get_layer</dd>
                <dd id="SequentialPolusClassifier.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="SequentialPolusClassifier.name_scope" class="variable">name_scope</dd>
                <dd id="SequentialPolusClassifier.submodules" class="variable">submodules</dd>
                <dd id="SequentialPolusClassifier.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="TFBertSplited">
                            <input id="TFBertSplited-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TFBertSplited</span><wbr>(<span class="base"><a href="#PolusModel">PolusModel</a></span>):

                <label class="view-source-button" for="TFBertSplited-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TFBertSplited"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TFBertSplited-165"><a href="#TFBertSplited-165"><span class="linenos">165</span></a><span class="k">class</span> <span class="nc">TFBertSplited</span><span class="p">(</span><span class="n">PolusModel</span><span class="p">):</span>
</span><span id="TFBertSplited-166"><a href="#TFBertSplited-166"><span class="linenos">166</span></a>    
</span><span id="TFBertSplited-167"><a href="#TFBertSplited-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TFBertSplited-168"><a href="#TFBertSplited-168"><span class="linenos">168</span></a>                 <span class="n">bert_layers</span><span class="p">,</span> 
</span><span id="TFBertSplited-169"><a href="#TFBertSplited-169"><span class="linenos">169</span></a>                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="TFBertSplited-170"><a href="#TFBertSplited-170"><span class="linenos">170</span></a>                 <span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TFBertSplited-171"><a href="#TFBertSplited-171"><span class="linenos">171</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TFBertSplited-172"><a href="#TFBertSplited-172"><span class="linenos">172</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TFBertSplited-173"><a href="#TFBertSplited-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">bert_layers</span>
</span><span id="TFBertSplited-174"><a href="#TFBertSplited-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="n">run_in_training_mode</span>
</span><span id="TFBertSplited-175"><a href="#TFBertSplited-175"><span class="linenos">175</span></a>    
</span><span id="TFBertSplited-176"><a href="#TFBertSplited-176"><span class="linenos">176</span></a>    <span class="k">def</span> <span class="nf">_efficient_attention_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span><span id="TFBertSplited-177"><a href="#TFBertSplited-177"><span class="linenos">177</span></a>        <span class="c1"># This codes mimics the transformer BERT implementation: https://github.com/huggingface/transformers/blob/master/src/transformers/models/bert/modeling_tf_bert.py#L1057</span>
</span><span id="TFBertSplited-178"><a href="#TFBertSplited-178"><span class="linenos">178</span></a>        
</span><span id="TFBertSplited-179"><a href="#TFBertSplited-179"><span class="linenos">179</span></a>        <span class="n">attention_mask_shape</span> <span class="o">=</span> <span class="n">shape_list</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="TFBertSplited-180"><a href="#TFBertSplited-180"><span class="linenos">180</span></a>
</span><span id="TFBertSplited-181"><a href="#TFBertSplited-181"><span class="linenos">181</span></a>        
</span><span id="TFBertSplited-182"><a href="#TFBertSplited-182"><span class="linenos">182</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="TFBertSplited-183"><a href="#TFBertSplited-183"><span class="linenos">183</span></a>                <span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">attention_mask_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">attention_mask_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="TFBertSplited-184"><a href="#TFBertSplited-184"><span class="linenos">184</span></a>            <span class="p">)</span>
</span><span id="TFBertSplited-185"><a href="#TFBertSplited-185"><span class="linenos">185</span></a>
</span><span id="TFBertSplited-186"><a href="#TFBertSplited-186"><span class="linenos">186</span></a>        <span class="c1"># Since attention_mask is 1.0 for positions we want to attend and 0.0 for</span>
</span><span id="TFBertSplited-187"><a href="#TFBertSplited-187"><span class="linenos">187</span></a>        <span class="c1"># masked positions, this operation will create a tensor which is 0.0 for</span>
</span><span id="TFBertSplited-188"><a href="#TFBertSplited-188"><span class="linenos">188</span></a>        <span class="c1"># positions we want to attend and -10000.0 for masked positions.</span>
</span><span id="TFBertSplited-189"><a href="#TFBertSplited-189"><span class="linenos">189</span></a>        <span class="c1"># Since we are adding it to the raw scores before the softmax, this is</span>
</span><span id="TFBertSplited-190"><a href="#TFBertSplited-190"><span class="linenos">190</span></a>        <span class="c1"># effectively the same as removing these entirely.</span>
</span><span id="TFBertSplited-191"><a href="#TFBertSplited-191"><span class="linenos">191</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">extended_attention_mask</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TFBertSplited-192"><a href="#TFBertSplited-192"><span class="linenos">192</span></a>        <span class="n">one_cst</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TFBertSplited-193"><a href="#TFBertSplited-193"><span class="linenos">193</span></a>        <span class="n">ten_thousand_cst</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="o">-</span><span class="mf">10000.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="TFBertSplited-194"><a href="#TFBertSplited-194"><span class="linenos">194</span></a>        <span class="n">extended_attention_mask</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">one_cst</span><span class="p">,</span> <span class="n">extended_attention_mask</span><span class="p">),</span> <span class="n">ten_thousand_cst</span><span class="p">)</span>
</span><span id="TFBertSplited-195"><a href="#TFBertSplited-195"><span class="linenos">195</span></a>        
</span><span id="TFBertSplited-196"><a href="#TFBertSplited-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="n">extended_attention_mask</span>
</span><span id="TFBertSplited-197"><a href="#TFBertSplited-197"><span class="linenos">197</span></a>    
</span><span id="TFBertSplited-198"><a href="#TFBertSplited-198"><span class="linenos">198</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">input_signature</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="TFBertSplited-199"><a href="#TFBertSplited-199"><span class="linenos">199</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="TFBertSplited-200"><a href="#TFBertSplited-200"><span class="linenos">200</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">bool</span><span class="p">)],</span>
</span><span id="TFBertSplited-201"><a href="#TFBertSplited-201"><span class="linenos">201</span></a>                <span class="n">jit_compile</span><span class="o">=</span><span class="n">get_jit_compile</span><span class="p">())</span>
</span><span id="TFBertSplited-202"><a href="#TFBertSplited-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TFBertSplited-203"><a href="#TFBertSplited-203"><span class="linenos">203</span></a>        
</span><span id="TFBertSplited-204"><a href="#TFBertSplited-204"><span class="linenos">204</span></a>        <span class="n">attention_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_efficient_attention_mask</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">)</span>
</span><span id="TFBertSplited-205"><a href="#TFBertSplited-205"><span class="linenos">205</span></a>        
</span><span id="TFBertSplited-206"><a href="#TFBertSplited-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">layer_module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">:</span>
</span><span id="TFBertSplited-207"><a href="#TFBertSplited-207"><span class="linenos">207</span></a>            <span class="n">hidden_states</span> <span class="o">=</span> <span class="n">layer_module</span><span class="p">(</span><span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span> 
</span><span id="TFBertSplited-208"><a href="#TFBertSplited-208"><span class="linenos">208</span></a>                                         <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
</span><span id="TFBertSplited-209"><a href="#TFBertSplited-209"><span class="linenos">209</span></a>                                         <span class="n">head_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited-210"><a href="#TFBertSplited-210"><span class="linenos">210</span></a>                                         <span class="n">output_attentions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited-211"><a href="#TFBertSplited-211"><span class="linenos">211</span></a>                                         <span class="n">encoder_hidden_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="TFBertSplited-212"><a href="#TFBertSplited-212"><span class="linenos">212</span></a>                                         <span class="n">encoder_attention_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="TFBertSplited-213"><a href="#TFBertSplited-213"><span class="linenos">213</span></a>                                         <span class="n">past_key_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited-214"><a href="#TFBertSplited-214"><span class="linenos">214</span></a>                                         <span class="n">training</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">&amp;</span> <span class="n">training</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TFBertSplited-215"><a href="#TFBertSplited-215"><span class="linenos">215</span></a>
</span><span id="TFBertSplited-216"><a href="#TFBertSplited-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="n">TFBaseModelOutputWithPooling</span><span class="p">(</span><span class="n">last_hidden_state</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span>
</span><span id="TFBertSplited-217"><a href="#TFBertSplited-217"><span class="linenos">217</span></a>                                            <span class="n">pooler_output</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:])</span>
</span></pre></div>


            <div class="docstring"><p><code>Model</code> groups layers into an object with training and inference features.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>inputs:</strong>  The input(s) of the model: a <code>keras.Input</code> object or list of
<code>keras.Input</code> objects.</li>
<li><strong>outputs:</strong>  The output(s) of the model. See Functional API example below.</li>
<li><strong>name:</strong>  String, the name of the model.</li>
</ul>

<p>There are two ways to instantiate a <code>Model</code>:</p>

<p>1 - With the "Functional API", where you start from <code>Input</code>,
you chain layer calls to specify the model's forward pass,
and finally you create your model from inputs and outputs:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="n">inputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)(</span><span class="n">x</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div>

<p>Note: Only dicts, lists, and tuples of input tensors are supported. Nested
inputs are not supported (e.g. lists of list or dicts of dict).</p>

<p>A new Functional API model can also be created by using the
intermediate tensors. This enables you to quickly extract sub-components
of the model.</p>

<p>Example:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">inputs</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">processed</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">32</span><span class="p">)(</span><span class="n">inputs</span><span class="p">)</span>
<span class="n">conv</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Conv2D</span><span class="p">(</span><span class="n">filters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">)(</span><span class="n">processed</span><span class="p">)</span>
<span class="n">pooling</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">GlobalAveragePooling2D</span><span class="p">()(</span><span class="n">conv</span><span class="p">)</span>
<span class="n">feature</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">10</span><span class="p">)(</span><span class="n">pooling</span><span class="p">)</span>

<span class="n">full_model</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
<span class="n">backbone</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">processed</span><span class="p">,</span> <span class="n">conv</span><span class="p">)</span>
<span class="n">activations</span> <span class="o">=</span> <span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">conv</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
</code></pre></div>

<p>Note that the <code>backbone</code> and <code>activations</code> models are not
created with <code>keras.Input</code> objects, but with the tensors that are originated
from <code>keras.Inputs</code> objects. Under the hood, the layers and weights will
be shared across these models, so that user can train the <code>full_model</code>, and
use <code>backbone</code> or <code>activations</code> to do feature extraction.
The inputs and outputs of the model can be nested structures of tensors as
well, and the created models are standard Functional API models that support
all the existing APIs.</p>

<p>2 - By subclassing the <code>Model</code> class: in that case, you should define your
layers in <code><a href="#TFBertSplited.__init__">__init__()</a></code> and you should implement the model's forward pass
in <code><a href="#TFBertSplited.call">call()</a></code>.</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>If you subclass <code>Model</code>, you can optionally have
a <code>training</code> argument (boolean) in <code><a href="#TFBertSplited.call">call()</a></code>, which you can use to specify
a different behavior in training and inference:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softmax</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">keras</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense1</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">training</span><span class="p">:</span>
      <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="n">training</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dense2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">()</span>
</code></pre></div>

<p>Once the model is created, you can config the model with losses and metrics
with <code>model.compile()</code>, train the model with <code>model.fit()</code>, or use the model
to do prediction with <code>model.predict()</code>.</p>
</div>


                            <div id="TFBertSplited.__init__" class="classattr">
                                        <input id="TFBertSplited.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TFBertSplited</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">bert_layers</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="n">run_in_training_mode</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="TFBertSplited.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TFBertSplited.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TFBertSplited.__init__-167"><a href="#TFBertSplited.__init__-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
</span><span id="TFBertSplited.__init__-168"><a href="#TFBertSplited.__init__-168"><span class="linenos">168</span></a>                 <span class="n">bert_layers</span><span class="p">,</span> 
</span><span id="TFBertSplited.__init__-169"><a href="#TFBertSplited.__init__-169"><span class="linenos">169</span></a>                 <span class="o">*</span><span class="n">args</span><span class="p">,</span>
</span><span id="TFBertSplited.__init__-170"><a href="#TFBertSplited.__init__-170"><span class="linenos">170</span></a>                 <span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="TFBertSplited.__init__-171"><a href="#TFBertSplited.__init__-171"><span class="linenos">171</span></a>                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="TFBertSplited.__init__-172"><a href="#TFBertSplited.__init__-172"><span class="linenos">172</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="TFBertSplited.__init__-173"><a href="#TFBertSplited.__init__-173"><span class="linenos">173</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">layer</span> <span class="o">=</span> <span class="n">bert_layers</span>
</span><span id="TFBertSplited.__init__-174"><a href="#TFBertSplited.__init__-174"><span class="linenos">174</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">=</span> <span class="n">run_in_training_mode</span>
</span></pre></div>


    

                            </div>
                            <div id="TFBertSplited.call" class="classattr">
                                        <input id="TFBertSplited.call-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@tf.function(input_signature=[tf.TensorSpec([None, None, None], dtype=tf.float32), tf.TensorSpec([None, None], dtype=tf.int32), tf.TensorSpec([], dtype=tf.bool)], jit_compile=get_jit_compile())</div>

        <span class="def">def</span>
        <span class="name">call</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">hidden_states</span>, </span><span class="param"><span class="n">attention_mask</span>, </span><span class="param"><span class="n">training</span><span class="o">=</span><span class="kc">False</span></span>)</span>

                <label class="view-source-button" for="TFBertSplited.call-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TFBertSplited.call"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TFBertSplited.call-198"><a href="#TFBertSplited.call-198"><span class="linenos">198</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">input_signature</span><span class="o">=</span><span class="p">[</span><span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>
</span><span id="TFBertSplited.call-199"><a href="#TFBertSplited.call-199"><span class="linenos">199</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">),</span>
</span><span id="TFBertSplited.call-200"><a href="#TFBertSplited.call-200"><span class="linenos">200</span></a>                                  <span class="n">tf</span><span class="o">.</span><span class="n">TensorSpec</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">bool</span><span class="p">)],</span>
</span><span id="TFBertSplited.call-201"><a href="#TFBertSplited.call-201"><span class="linenos">201</span></a>                <span class="n">jit_compile</span><span class="o">=</span><span class="n">get_jit_compile</span><span class="p">())</span>
</span><span id="TFBertSplited.call-202"><a href="#TFBertSplited.call-202"><span class="linenos">202</span></a>    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="TFBertSplited.call-203"><a href="#TFBertSplited.call-203"><span class="linenos">203</span></a>        
</span><span id="TFBertSplited.call-204"><a href="#TFBertSplited.call-204"><span class="linenos">204</span></a>        <span class="n">attention_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_efficient_attention_mask</span><span class="p">(</span><span class="n">attention_mask</span><span class="p">)</span>
</span><span id="TFBertSplited.call-205"><a href="#TFBertSplited.call-205"><span class="linenos">205</span></a>        
</span><span id="TFBertSplited.call-206"><a href="#TFBertSplited.call-206"><span class="linenos">206</span></a>        <span class="k">for</span> <span class="n">layer_module</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer</span><span class="p">:</span>
</span><span id="TFBertSplited.call-207"><a href="#TFBertSplited.call-207"><span class="linenos">207</span></a>            <span class="n">hidden_states</span> <span class="o">=</span> <span class="n">layer_module</span><span class="p">(</span><span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span> 
</span><span id="TFBertSplited.call-208"><a href="#TFBertSplited.call-208"><span class="linenos">208</span></a>                                         <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>
</span><span id="TFBertSplited.call-209"><a href="#TFBertSplited.call-209"><span class="linenos">209</span></a>                                         <span class="n">head_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited.call-210"><a href="#TFBertSplited.call-210"><span class="linenos">210</span></a>                                         <span class="n">output_attentions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited.call-211"><a href="#TFBertSplited.call-211"><span class="linenos">211</span></a>                                         <span class="n">encoder_hidden_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="TFBertSplited.call-212"><a href="#TFBertSplited.call-212"><span class="linenos">212</span></a>                                         <span class="n">encoder_attention_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
</span><span id="TFBertSplited.call-213"><a href="#TFBertSplited.call-213"><span class="linenos">213</span></a>                                         <span class="n">past_key_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TFBertSplited.call-214"><a href="#TFBertSplited.call-214"><span class="linenos">214</span></a>                                         <span class="n">training</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run_in_training_mode</span> <span class="o">&amp;</span> <span class="n">training</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="TFBertSplited.call-215"><a href="#TFBertSplited.call-215"><span class="linenos">215</span></a>
</span><span id="TFBertSplited.call-216"><a href="#TFBertSplited.call-216"><span class="linenos">216</span></a>        <span class="k">return</span> <span class="n">TFBaseModelOutputWithPooling</span><span class="p">(</span><span class="n">last_hidden_state</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span>
</span><span id="TFBertSplited.call-217"><a href="#TFBertSplited.call-217"><span class="linenos">217</span></a>                                            <span class="n">pooler_output</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">[:,</span><span class="mi">0</span><span class="p">,:])</span>
</span></pre></div>


    

                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#PolusModel">PolusModel</a></dt>
                                <dd id="TFBertSplited.init_from_data" class="function"><a href="#PolusModel.init_from_data">init_from_data</a></dd>
                <dd id="TFBertSplited.set_name" class="function"><a href="#PolusModel.set_name">set_name</a></dd>

            </div>
            <div><dt>keras.engine.training.Model</dt>
                                <dd id="TFBertSplited.build" class="function">build</dd>
                <dd id="TFBertSplited.compile" class="function">compile</dd>
                <dd id="TFBertSplited.metrics" class="variable">metrics</dd>
                <dd id="TFBertSplited.metrics_names" class="variable">metrics_names</dd>
                <dd id="TFBertSplited.distribute_strategy" class="variable">distribute_strategy</dd>
                <dd id="TFBertSplited.run_eagerly" class="variable">run_eagerly</dd>
                <dd id="TFBertSplited.train_step" class="function">train_step</dd>
                <dd id="TFBertSplited.compute_loss" class="function">compute_loss</dd>
                <dd id="TFBertSplited.compute_metrics" class="function">compute_metrics</dd>
                <dd id="TFBertSplited.make_train_function" class="function">make_train_function</dd>
                <dd id="TFBertSplited.fit" class="function">fit</dd>
                <dd id="TFBertSplited.test_step" class="function">test_step</dd>
                <dd id="TFBertSplited.make_test_function" class="function">make_test_function</dd>
                <dd id="TFBertSplited.evaluate" class="function">evaluate</dd>
                <dd id="TFBertSplited.predict_step" class="function">predict_step</dd>
                <dd id="TFBertSplited.make_predict_function" class="function">make_predict_function</dd>
                <dd id="TFBertSplited.predict" class="function">predict</dd>
                <dd id="TFBertSplited.reset_metrics" class="function">reset_metrics</dd>
                <dd id="TFBertSplited.train_on_batch" class="function">train_on_batch</dd>
                <dd id="TFBertSplited.test_on_batch" class="function">test_on_batch</dd>
                <dd id="TFBertSplited.predict_on_batch" class="function">predict_on_batch</dd>
                <dd id="TFBertSplited.fit_generator" class="function">fit_generator</dd>
                <dd id="TFBertSplited.evaluate_generator" class="function">evaluate_generator</dd>
                <dd id="TFBertSplited.predict_generator" class="function">predict_generator</dd>
                <dd id="TFBertSplited.trainable_weights" class="variable">trainable_weights</dd>
                <dd id="TFBertSplited.non_trainable_weights" class="variable">non_trainable_weights</dd>
                <dd id="TFBertSplited.get_weights" class="function">get_weights</dd>
                <dd id="TFBertSplited.save" class="function">save</dd>
                <dd id="TFBertSplited.save_weights" class="function">save_weights</dd>
                <dd id="TFBertSplited.load_weights" class="function">load_weights</dd>
                <dd id="TFBertSplited.get_config" class="function">get_config</dd>
                <dd id="TFBertSplited.from_config" class="function">from_config</dd>
                <dd id="TFBertSplited.to_json" class="function">to_json</dd>
                <dd id="TFBertSplited.to_yaml" class="function">to_yaml</dd>
                <dd id="TFBertSplited.reset_states" class="function">reset_states</dd>
                <dd id="TFBertSplited.state_updates" class="variable">state_updates</dd>
                <dd id="TFBertSplited.weights" class="variable">weights</dd>
                <dd id="TFBertSplited.summary" class="function">summary</dd>
                <dd id="TFBertSplited.layers" class="variable">layers</dd>
                <dd id="TFBertSplited.get_layer" class="function">get_layer</dd>
                <dd id="TFBertSplited.save_spec" class="function">save_spec</dd>

            </div>
            <div><dt>keras.engine.base_layer.Layer</dt>
                                <dd id="TFBertSplited.add_weight" class="function">add_weight</dd>
                <dd id="TFBertSplited.compute_output_shape" class="function">compute_output_shape</dd>
                <dd id="TFBertSplited.compute_output_signature" class="function">compute_output_signature</dd>
                <dd id="TFBertSplited.compute_mask" class="function">compute_mask</dd>
                <dd id="TFBertSplited.dtype" class="variable">dtype</dd>
                <dd id="TFBertSplited.name" class="variable">name</dd>
                <dd id="TFBertSplited.supports_masking" class="variable">supports_masking</dd>
                <dd id="TFBertSplited.dynamic" class="variable">dynamic</dd>
                <dd id="TFBertSplited.stateful" class="variable">stateful</dd>
                <dd id="TFBertSplited.trainable" class="variable">trainable</dd>
                <dd id="TFBertSplited.activity_regularizer" class="variable">activity_regularizer</dd>
                <dd id="TFBertSplited.input_spec" class="variable">input_spec</dd>
                <dd id="TFBertSplited.updates" class="variable">updates</dd>
                <dd id="TFBertSplited.losses" class="variable">losses</dd>
                <dd id="TFBertSplited.add_loss" class="function">add_loss</dd>
                <dd id="TFBertSplited.add_metric" class="function">add_metric</dd>
                <dd id="TFBertSplited.add_update" class="function">add_update</dd>
                <dd id="TFBertSplited.set_weights" class="function">set_weights</dd>
                <dd id="TFBertSplited.finalize_state" class="function">finalize_state</dd>
                <dd id="TFBertSplited.get_input_mask_at" class="function">get_input_mask_at</dd>
                <dd id="TFBertSplited.get_output_mask_at" class="function">get_output_mask_at</dd>
                <dd id="TFBertSplited.input_mask" class="variable">input_mask</dd>
                <dd id="TFBertSplited.output_mask" class="variable">output_mask</dd>
                <dd id="TFBertSplited.get_input_shape_at" class="function">get_input_shape_at</dd>
                <dd id="TFBertSplited.get_output_shape_at" class="function">get_output_shape_at</dd>
                <dd id="TFBertSplited.get_input_at" class="function">get_input_at</dd>
                <dd id="TFBertSplited.get_output_at" class="function">get_output_at</dd>
                <dd id="TFBertSplited.input" class="variable">input</dd>
                <dd id="TFBertSplited.output" class="variable">output</dd>
                <dd id="TFBertSplited.input_shape" class="variable">input_shape</dd>
                <dd id="TFBertSplited.count_params" class="function">count_params</dd>
                <dd id="TFBertSplited.output_shape" class="variable">output_shape</dd>
                <dd id="TFBertSplited.dtype_policy" class="variable">dtype_policy</dd>
                <dd id="TFBertSplited.compute_dtype" class="variable">compute_dtype</dd>
                <dd id="TFBertSplited.variable_dtype" class="variable">variable_dtype</dd>
                <dd id="TFBertSplited.inbound_nodes" class="variable">inbound_nodes</dd>
                <dd id="TFBertSplited.outbound_nodes" class="variable">outbound_nodes</dd>
                <dd id="TFBertSplited.variables" class="variable">variables</dd>
                <dd id="TFBertSplited.trainable_variables" class="variable">trainable_variables</dd>
                <dd id="TFBertSplited.non_trainable_variables" class="variable">non_trainable_variables</dd>
                <dd id="TFBertSplited.add_variable" class="function">add_variable</dd>

            </div>
            <div><dt>tensorflow.python.module.module.Module</dt>
                                <dd id="TFBertSplited.name_scope" class="variable">name_scope</dd>
                <dd id="TFBertSplited.submodules" class="variable">submodules</dd>
                <dd id="TFBertSplited.with_name_scope" class="function">with_name_scope</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="split_bert_model_from_checkpoint">
                            <input id="split_bert_model_from_checkpoint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_bert_model_from_checkpoint</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">bert_model_checkpoint</span>,</span><span class="param">	<span class="n">index_layer</span>,</span><span class="param">	<span class="n">init_models</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="split_bert_model_from_checkpoint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#split_bert_model_from_checkpoint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="split_bert_model_from_checkpoint-220"><a href="#split_bert_model_from_checkpoint-220"><span class="linenos">220</span></a><span class="k">def</span> <span class="nf">split_bert_model_from_checkpoint</span><span class="p">(</span><span class="n">bert_model_checkpoint</span><span class="p">,</span> 
</span><span id="split_bert_model_from_checkpoint-221"><a href="#split_bert_model_from_checkpoint-221"><span class="linenos">221</span></a>                                     <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="split_bert_model_from_checkpoint-222"><a href="#split_bert_model_from_checkpoint-222"><span class="linenos">222</span></a>                                     <span class="n">init_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-223"><a href="#split_bert_model_from_checkpoint-223"><span class="linenos">223</span></a>                                     <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-224"><a href="#split_bert_model_from_checkpoint-224"><span class="linenos">224</span></a>                                     <span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="split_bert_model_from_checkpoint-225"><a href="#split_bert_model_from_checkpoint-225"><span class="linenos">225</span></a>    
</span><span id="split_bert_model_from_checkpoint-226"><a href="#split_bert_model_from_checkpoint-226"><span class="linenos">226</span></a>    <span class="n">bert_model</span> <span class="o">=</span> <span class="n">TFBertModel</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">bert_model_checkpoint</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-227"><a href="#split_bert_model_from_checkpoint-227"><span class="linenos">227</span></a>                                             <span class="n">output_attentions</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-228"><a href="#split_bert_model_from_checkpoint-228"><span class="linenos">228</span></a>                                             <span class="n">output_hidden_states</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-229"><a href="#split_bert_model_from_checkpoint-229"><span class="linenos">229</span></a>                                             <span class="n">return_dict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-230"><a href="#split_bert_model_from_checkpoint-230"><span class="linenos">230</span></a>                                             <span class="n">from_pt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="split_bert_model_from_checkpoint-231"><a href="#split_bert_model_from_checkpoint-231"><span class="linenos">231</span></a>    
</span><span id="split_bert_model_from_checkpoint-232"><a href="#split_bert_model_from_checkpoint-232"><span class="linenos">232</span></a>    <span class="n">output</span> <span class="o">=</span> <span class="n">split_bert_model</span><span class="p">(</span><span class="n">bert_model</span><span class="p">,</span> 
</span><span id="split_bert_model_from_checkpoint-233"><a href="#split_bert_model_from_checkpoint-233"><span class="linenos">233</span></a>                              <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="split_bert_model_from_checkpoint-234"><a href="#split_bert_model_from_checkpoint-234"><span class="linenos">234</span></a>                              <span class="n">init_models</span><span class="o">=</span><span class="n">init_models</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-235"><a href="#split_bert_model_from_checkpoint-235"><span class="linenos">235</span></a>                              <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="n">return_pre_bert_model</span><span class="p">,</span>
</span><span id="split_bert_model_from_checkpoint-236"><a href="#split_bert_model_from_checkpoint-236"><span class="linenos">236</span></a>                              <span class="n">return_post_bert_model</span><span class="o">=</span><span class="n">return_post_bert_model</span><span class="p">)</span>
</span><span id="split_bert_model_from_checkpoint-237"><a href="#split_bert_model_from_checkpoint-237"><span class="linenos">237</span></a>    
</span><span id="split_bert_model_from_checkpoint-238"><a href="#split_bert_model_from_checkpoint-238"><span class="linenos">238</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model_from_checkpoint-239"><a href="#split_bert_model_from_checkpoint-239"><span class="linenos">239</span></a>        <span class="k">del</span> <span class="n">bert_model</span>
</span><span id="split_bert_model_from_checkpoint-240"><a href="#split_bert_model_from_checkpoint-240"><span class="linenos">240</span></a>    
</span><span id="split_bert_model_from_checkpoint-241"><a href="#split_bert_model_from_checkpoint-241"><span class="linenos">241</span></a>    <span class="k">return</span> <span class="n">output</span>
</span></pre></div>


    

                </section>
                <section id="split_bert_model">
                            <input id="split_bert_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">split_bert_model</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">bert_model</span>,</span><span class="param">	<span class="n">index_layer</span>,</span><span class="param">	<span class="n">init_models</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span>,</span><span class="param">	<span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span></span>)</span>

                <label class="view-source-button" for="split_bert_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#split_bert_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="split_bert_model-243"><a href="#split_bert_model-243"><span class="linenos">243</span></a><span class="k">def</span> <span class="nf">split_bert_model</span><span class="p">(</span><span class="n">bert_model</span><span class="p">,</span> 
</span><span id="split_bert_model-244"><a href="#split_bert_model-244"><span class="linenos">244</span></a>                     <span class="n">index_layer</span><span class="p">,</span> 
</span><span id="split_bert_model-245"><a href="#split_bert_model-245"><span class="linenos">245</span></a>                     <span class="n">init_models</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="split_bert_model-246"><a href="#split_bert_model-246"><span class="linenos">246</span></a>                     <span class="n">return_pre_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model-247"><a href="#split_bert_model-247"><span class="linenos">247</span></a>                     <span class="n">return_post_bert_model</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="split_bert_model-248"><a href="#split_bert_model-248"><span class="linenos">248</span></a>    <span class="sd">&quot;&quot;&quot;</span>
</span><span id="split_bert_model-249"><a href="#split_bert_model-249"><span class="linenos">249</span></a><span class="sd">    Utility function that splits a bert model in a pre established index, given by *index_layer*,</span>
</span><span id="split_bert_model-250"><a href="#split_bert_model-250"><span class="linenos">250</span></a><span class="sd">    which results into two models. The *pre_model* that corresponds to the *bert_model* but without</span>
</span><span id="split_bert_model-251"><a href="#split_bert_model-251"><span class="linenos">251</span></a><span class="sd">    a some layers that were cut off and a *post_model* that corresponds to a *PolusModel*, which runs</span>
</span><span id="split_bert_model-252"><a href="#split_bert_model-252"><span class="linenos">252</span></a><span class="sd">    the remain bert layers.</span>
</span><span id="split_bert_model-253"><a href="#split_bert_model-253"><span class="linenos">253</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="split_bert_model-254"><a href="#split_bert_model-254"><span class="linenos">254</span></a>    
</span><span id="split_bert_model-255"><a href="#split_bert_model-255"><span class="linenos">255</span></a>    <span class="k">assert</span> <span class="n">return_pre_bert_model</span> <span class="ow">or</span> <span class="n">return_post_bert_model</span> <span class="c1"># at least one must be true</span>
</span><span id="split_bert_model-256"><a href="#split_bert_model-256"><span class="linenos">256</span></a>    
</span><span id="split_bert_model-257"><a href="#split_bert_model-257"><span class="linenos">257</span></a>    <span class="k">assert</span>  <span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="o">&gt;</span> <span class="n">index_layer</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="ow">and</span> <span class="n">index_layer</span><span class="o">!=</span><span class="mi">0</span>
</span><span id="split_bert_model-258"><a href="#split_bert_model-258"><span class="linenos">258</span></a>    
</span><span id="split_bert_model-259"><a href="#split_bert_model-259"><span class="linenos">259</span></a>    <span class="c1"># create a new keras model that uses the layers previous removed bert layers</span>
</span><span id="split_bert_model-260"><a href="#split_bert_model-260"><span class="linenos">260</span></a>    <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-261"><a href="#split_bert_model-261"><span class="linenos">261</span></a>        <span class="n">encoder_layers</span> <span class="o">=</span> <span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">[</span><span class="n">index_layer</span><span class="p">:]</span>
</span><span id="split_bert_model-262"><a href="#split_bert_model-262"><span class="linenos">262</span></a>        <span class="n">post_model</span> <span class="o">=</span> <span class="n">TFBertSplited</span><span class="p">(</span><span class="n">encoder_layers</span><span class="p">)</span>
</span><span id="split_bert_model-263"><a href="#split_bert_model-263"><span class="linenos">263</span></a>    
</span><span id="split_bert_model-264"><a href="#split_bert_model-264"><span class="linenos">264</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-265"><a href="#split_bert_model-265"><span class="linenos">265</span></a>        <span class="k">del</span> <span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">[</span><span class="n">index_layer</span><span class="p">:]</span>
</span><span id="split_bert_model-266"><a href="#split_bert_model-266"><span class="linenos">266</span></a>        <span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">num_hidden_layers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bert_model</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">layer</span><span class="p">)</span>
</span><span id="split_bert_model-267"><a href="#split_bert_model-267"><span class="linenos">267</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="split_bert_model-268"><a href="#split_bert_model-268"><span class="linenos">268</span></a>        <span class="k">del</span> <span class="n">bert_model</span>
</span><span id="split_bert_model-269"><a href="#split_bert_model-269"><span class="linenos">269</span></a>    
</span><span id="split_bert_model-270"><a href="#split_bert_model-270"><span class="linenos">270</span></a>    
</span><span id="split_bert_model-271"><a href="#split_bert_model-271"><span class="linenos">271</span></a>    
</span><span id="split_bert_model-272"><a href="#split_bert_model-272"><span class="linenos">272</span></a>    <span class="k">if</span> <span class="n">init_models</span> <span class="ow">and</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-273"><a href="#split_bert_model-273"><span class="linenos">273</span></a>        <span class="c1"># run a dummy example to build post_model and check for errors</span>
</span><span id="split_bert_model-274"><a href="#split_bert_model-274"><span class="linenos">274</span></a>        <span class="n">sample</span> <span class="o">=</span> <span class="s2">&quot;hello, this is a sample that i want to tokenize&quot;</span>
</span><span id="split_bert_model-275"><a href="#split_bert_model-275"><span class="linenos">275</span></a>        
</span><span id="split_bert_model-276"><a href="#split_bert_model-276"><span class="linenos">276</span></a>        <span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">bert_model</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">_name_or_path</span><span class="p">)</span>
</span><span id="split_bert_model-277"><a href="#split_bert_model-277"><span class="linenos">277</span></a>        
</span><span id="split_bert_model-278"><a href="#split_bert_model-278"><span class="linenos">278</span></a>        <span class="n">inputs</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode_plus</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span>
</span><span id="split_bert_model-279"><a href="#split_bert_model-279"><span class="linenos">279</span></a>                                           <span class="n">padding</span> <span class="o">=</span> <span class="s2">&quot;max_length&quot;</span><span class="p">,</span>
</span><span id="split_bert_model-280"><a href="#split_bert_model-280"><span class="linenos">280</span></a>                                           <span class="n">truncation</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model-281"><a href="#split_bert_model-281"><span class="linenos">281</span></a>                                           <span class="n">max_length</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
</span><span id="split_bert_model-282"><a href="#split_bert_model-282"><span class="linenos">282</span></a>                                           <span class="n">return_attention_mask</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model-283"><a href="#split_bert_model-283"><span class="linenos">283</span></a>                                           <span class="n">return_token_type_ids</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="split_bert_model-284"><a href="#split_bert_model-284"><span class="linenos">284</span></a>                                           <span class="n">return_tensors</span> <span class="o">=</span> <span class="s2">&quot;tf&quot;</span><span class="p">,</span>
</span><span id="split_bert_model-285"><a href="#split_bert_model-285"><span class="linenos">285</span></a>                                          <span class="p">)</span>
</span><span id="split_bert_model-286"><a href="#split_bert_model-286"><span class="linenos">286</span></a>        <span class="n">hidden_states</span> <span class="o">=</span> <span class="n">bert_model</span><span class="p">(</span><span class="o">**</span><span class="n">inputs</span><span class="p">)[</span><span class="s2">&quot;last_hidden_state&quot;</span><span class="p">]</span>
</span><span id="split_bert_model-287"><a href="#split_bert_model-287"><span class="linenos">287</span></a>            
</span><span id="split_bert_model-288"><a href="#split_bert_model-288"><span class="linenos">288</span></a>        <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-289"><a href="#split_bert_model-289"><span class="linenos">289</span></a>            <span class="n">post_model</span><span class="p">(</span><span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="s2">&quot;attention_mask&quot;</span><span class="p">])</span>
</span><span id="split_bert_model-290"><a href="#split_bert_model-290"><span class="linenos">290</span></a>    
</span><span id="split_bert_model-291"><a href="#split_bert_model-291"><span class="linenos">291</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span> <span class="ow">and</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-292"><a href="#split_bert_model-292"><span class="linenos">292</span></a>        <span class="k">return</span> <span class="n">bert_model</span><span class="p">,</span> <span class="n">post_model</span>
</span><span id="split_bert_model-293"><a href="#split_bert_model-293"><span class="linenos">293</span></a>    <span class="k">if</span> <span class="n">return_pre_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-294"><a href="#split_bert_model-294"><span class="linenos">294</span></a>        <span class="k">return</span> <span class="n">bert_model</span>
</span><span id="split_bert_model-295"><a href="#split_bert_model-295"><span class="linenos">295</span></a>    <span class="k">if</span> <span class="n">return_post_bert_model</span><span class="p">:</span>
</span><span id="split_bert_model-296"><a href="#split_bert_model-296"><span class="linenos">296</span></a>        <span class="k">return</span> <span class="n">post_model</span>
</span></pre></div>


            <div class="docstring"><p>Utility function that splits a bert model in a pre established index, given by <em>index_layer</em>,
which results into two models. The <em>pre_model</em> that corresponds to the <em>bert_model</em> but without
a some layers that were cut off and a <em>post_model</em> that corresponds to a <em>PolusModel</em>, which runs
the remain bert layers.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>